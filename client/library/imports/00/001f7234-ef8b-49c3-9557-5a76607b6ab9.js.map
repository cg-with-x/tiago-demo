{"version":3,"sources":["../../../../assets/scripts/assets/scripts/room_manager.js"],"names":["RoomManager","room","on","console","log","cc","director","loadScene","message","scene","getScene","name","getComponent","onRoomMessage","setTimeout","reconnect","param","close","module","exports"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;;;AAEA;IACMA;AACF,2BAAc;AAAA;;AACV,aAAKC,IAAL,GAAY,IAAZ;AACH;;;;iCAEQA,MAAM;AACX,iBAAKA,IAAL,GAAYA,IAAZ;;AAEAA,iBAAKC,EAAL,CAAQ,MAAR,EAAgB,YAAM;AAClBC,wBAAQC,GAAR,CAAY,gBAAZ;;AAEAC,mBAAGC,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,aAJD;;AAMAN,iBAAKC,EAAL,CAAQ,SAAR,EAAmB,gBAAiB;AAAA,oBAAdM,OAAc,QAAdA,OAAc;;AAChCL,wBAAQC,GAAR,CAAY,gBAAZ,EAA8BI,OAA9B;;AAEA,oBAAMC,QAAQJ,GAAGC,QAAH,CAAYI,QAAZ,EAAd;AACA,oBAAID,MAAME,IAAN,KAAe,MAAnB,EAA2B;AACvBF,0BAAMG,YAAN,CAAmB,MAAnB,EAA2BC,aAA3B,CAAyCL,OAAzC;AACH;AACJ,aAPD;;AASAP,iBAAKC,EAAL,CAAQ,OAAR,EAAiB,YAAM;AACnBC,wBAAQC,GAAR,CAAY,cAAZ;;AAEA;AACAU,2BAAW,YAAM;AACbb,yBAAKc,SAAL;AACH,iBAFD,EAEG,IAFH;AAGH,aAPD;;AASAd,iBAAKC,EAAL,CAAQ,OAAR,EAAiB,UAACc,KAAD,EAAW;AACxBb,wBAAQC,GAAR,CAAY,cAAZ,EAA4BY,KAA5B;AACH,aAFD;;AAIAf,iBAAKC,EAAL,CAAQ,cAAR,EAAwB,UAACc,KAAD,EAAW;AAC/Bb,wBAAQC,GAAR,CAAY,eAAZ,EAA6BY,KAA7B;AACH,aAFD;AAGH;;;gCAEO;AACJ,gBAAI,KAAKf,IAAT,EAAe;AACX,qBAAKA,IAAL,CAAUgB,KAAV;AACA,qBAAKhB,IAAL,GAAY,IAAZ;AACH;AACJ;;;;;;AAGLiB,OAAOC,OAAP,GAAiB,IAAInB,WAAJ,EAAjB","file":"room_manager.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import tiago from '@byted-creative/tiago';\nimport dataManager from './data_manager';\n\n// NOTE: 房间服务的事件抽出单独处理\nclass RoomManager {\n    constructor() {\n        this.room = null;\n    }\n\n    loadRoom(room) {\n        this.room = room;\n\n        room.on('open', () => {\n            console.log('[room] 进入游戏成功!');\n\n            cc.director.loadScene('game');\n        });\n\n        room.on('message', ({ message }) => {\n            console.log('[room] 接受到消息: ', message);\n\n            const scene = cc.director.getScene();\n            if (scene.name === 'game') {\n                scene.getComponent('game').onRoomMessage(message);\n            }\n        });\n\n        room.on('close', () => {\n            console.log('[room] 房间关闭!');\n\n            // NOTE: 根据需要进行重新连接\n            setTimeout(() => {\n                room.reconnect();\n            }, 1000)\n        });\n\n        room.on('error', (param) => {\n            console.log('[room] 房间出错:', param);\n        });\n\n        room.on('reconnecting', (param) => {\n            console.log('[room] 重连中...', param);\n        });\n    }\n\n    leave() {\n        if (this.room) {\n            this.room.close();\n            this.room = null;\n        }\n    }\n}\n\nmodule.exports = new RoomManager();"]}