{"version":3,"sources":["../../../../assets/scripts/assets/scripts/game.js"],"names":["cc","Class","extends","Component","playerAOpenId","playerBOpenId","properties","labelPlayerATip","Label","labelPlayerANickName","spritePlayerAAvatar","Sprite","labelPlayerBTip","labelPlayerBNickName","spritePlayerBAvatar","labelServerTime","start","onClickStopGame","roomManager","room","send","JSON","stringify","event","dataManager","tiago","leaveRtcFromGameRoom","leave","director","loadScene","currentTeam","return","onClickTalk","data","parseInt","Math","random","onClickReconnect","reconnect","onRoomMessage","messageStr","message","parse","length","forEach","environment","twoPlayersInfo","renderPlayers","string","renderTalk","playerA","playerB","openId","name","isAI","nickName","utils","renderAvatar","avatarUrl","tip"],"mappings":"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","file":"game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import roomManager from './room_manager';\n\nimport utils from './utils';\nimport dataManager from './data_manager';        \n\ncc.Class({\n    extends: cc.Component,                \n\n    playerAOpenId: '',   \n    playerBOpenId: '',         \n\n    properties: {\n        labelPlayerATip: cc.Label,\n        labelPlayerANickName: cc.Label,\n        spritePlayerAAvatar: cc.Sprite,\n\n        labelPlayerBTip: cc.Label,\n        labelPlayerBNickName: cc.Label,\n        spritePlayerBAvatar: cc.Sprite,\n\n        labelServerTime: cc.Label,\n    },\n\n    start () {\n\n    },\n\n    onClickStopGame() {\n        roomManager.room.send(JSON.stringify({\n            event: 'bye',\n        }));\n        // NOTE: 推出连麦\n        if (dataManager.tiago) dataManager.tiago.leaveRtcFromGameRoom(roomManager.room);\n\n        roomManager.leave();\n        cc.director.loadScene('start');\n\n        // NOTE: 如果之前在一个组队中，则回到队伍\n        if (dataManager.currentTeam) dataManager.currentTeam.return();\n    },\n\n    onClickTalk() {\n        if (roomManager.room) {\n            roomManager.room.send(JSON.stringify({\n                event: 'talk',\n                data: parseInt(Math.random() * 100),\n            }));\n        }\n    },\n\n    onClickReconnect() {\n        if (roomManager.room) {\n            roomManager.room.reconnect();\n        }\n    },\n\n    onRoomMessage(messageStr) {\n        // NOTE: 消息体的内容是开发者自己定义的，这里的代码只是一种示例\n        // NOTE: 开发者可以根据自己的房间脚本和协议，实现自身游戏的逻辑\n        const message = JSON.parse(messageStr);\n\n        if (message.length) {\n            message.forEach(({ event, data }) => {\n                switch (event) {\n                    case 'game-start':\n                        break;\n                    case 'environment':\n                        dataManager.environment = data;\n                        break;\n                    case 'info':\n                        dataManager.twoPlayersInfo = data;\n                        this.renderPlayers();\n                        break;\n                    case 'server-time':\n                        this.labelServerTime.string = `${dataManager.environment}: ${data}`;\n                        break;\n                    case 'talk':\n                        this.renderTalk(data);\n                        break;\n                    case 'game-over':\n                        // NOTE: 推出连麦\n                        if (dataManager.tiago) dataManager.tiago.leaveRtcFromGameRoom(roomManager.room);\n                        roomManager.leave();\n                        cc.director.loadScene('start');\n                        // NOTE: 如果之前在一个组队中，则回到队伍\n                        if (dataManager.currentTeam) dataManager.currentTeam.return();\n                        break;\n                    default:\n                        break;\n                }\n            })\n        }\n    },\n\n    renderPlayers() {\n        if (dataManager.twoPlayersInfo) {\n            const [ playerA, playerB ] = dataManager.twoPlayersInfo;\n\n            if (playerA) {\n                this.playerAOpenId = playerA.openId;\n                const name = playerA.isAI ? `AI: ${playerA.nickName}` : playerA.nickName;\n                this.labelPlayerANickName.string = name;\n                utils.renderAvatar(this.spritePlayerAAvatar, playerA.avatarUrl);\n            }\n\n            if (playerB) {\n                this.playerBOpenId = playerB.openId;\n                const name = playerB.isAI ? `AI: ${playerB.nickName}` : playerB.nickName;\n                this.labelPlayerBNickName.string = name;\n                utils.renderAvatar(this.spritePlayerBAvatar, playerB.avatarUrl);\n            }\n        }\n    },\n\n    renderTalk({ openId, data }) {\n        const tip = `战斗力 +${data}`;\n        if (openId === this.playerAOpenId) {\n            this.labelPlayerATip.string = tip;\n        } else if (openId === this.playerBOpenId) {\n            this.labelPlayerBTip.string = tip;\n        }\n    }\n\n    // update (dt) {},\n});\n"]}