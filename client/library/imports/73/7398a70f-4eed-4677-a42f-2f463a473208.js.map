{"version":3,"sources":["../../../../assets/scripts/assets/scripts/game.js"],"names":["cc","Class","extends","Component","properties","labelPlayerATip","Label","labelPlayerANickName","spritePlayerAAvatar","Sprite","labelPlayerBTip","labelPlayerBNickName","spritePlayerBAvatar","start","onClickStopGame","roomManager","leave","director","loadScene","onClickTalk","room","send","JSON","stringify","event","data","parseInt","Math","random","onRoomMessage","messageStr","message","parse","length","forEach","dataManager","environment","twoPlayersInfo","renderPlayers","playerA","playerB","string","nickName","utils","renderAvatar","avatarUrl"],"mappings":";;;;;;;;AAAA;;;;AAEA;;;;AACA;;;;;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,yBAAiBL,GAAGM,KADZ;AAERC,8BAAsBP,GAAGM,KAFjB;AAGRE,6BAAqBR,GAAGS,MAHhB;;AAKRC,yBAAiBV,GAAGM,KALZ;AAMRK,8BAAsBX,GAAGM,KANjB;AAORM,6BAAqBZ,GAAGS;AAPhB,KAHP;;AAaLI,SAbK,mBAaI,CAER,CAfI;AAiBLC,mBAjBK,6BAiBa;AACdC,+BAAYC,KAAZ;AACAhB,WAAGiB,QAAH,CAAYC,SAAZ,CAAsB,OAAtB;AACH,KApBI;AAsBLC,eAtBK,yBAsBS;AACV,YAAIJ,uBAAYK,IAAhB,EAAsB;AAClBL,mCAAYK,IAAZ,CAAiBC,IAAjB,CAAsBC,KAAKC,SAAL,CAAe;AACjCC,uBAAO,MAD0B;AAEjCC,sBAAMC,SAASC,KAAKC,MAAL,KAAgB,GAAzB;AAF2B,aAAf,CAAtB;AAIH;AACJ,KA7BI;AA+BLC,iBA/BK,yBA+BSC,UA/BT,EA+BqB;AAAA;;AACtB;AACA;AACA,YAAMC,UAAUT,KAAKU,KAAL,CAAWF,UAAX,CAAhB;;AAEA,YAAIC,QAAQE,MAAZ,EAAoB;AAChBF,oBAAQG,OAAR,CAAgB,gBAAqB;AAAA,oBAAlBV,KAAkB,QAAlBA,KAAkB;AAAA,oBAAXC,IAAW,QAAXA,IAAW;;AACjC,wBAAQD,KAAR;AACI,yBAAK,aAAL;AACIW,+CAAYC,WAAZ,GAA0BX,IAA1B;AACA;AACJ,yBAAK,MAAL;AACIU,+CAAYE,cAAZ,GAA6BZ,IAA7B;AACA,8BAAKa,aAAL;AACA;AACJ,yBAAK,aAAL;AACI;AACJ,yBAAK,MAAL;AACI;AACJ,yBAAK,KAAL;AACI;AACJ;AACI;AAfR;AAiBH,aAlBD;AAmBH;AACJ,KAzDI;AA2DLA,iBA3DK,2BA2DW;AACZ,YAAIH,uBAAYE,cAAhB,EAAgC;AAAA,uDACCF,uBAAYE,cADb;AAAA,gBACpBE,OADoB;AAAA,gBACXC,OADW;;AAG5B,gBAAID,OAAJ,EAAa;AACT,qBAAKhC,oBAAL,CAA0BkC,MAA1B,GAAmCF,QAAQG,QAA3C;AACAC,gCAAMC,YAAN,CAAmB,KAAKpC,mBAAxB,EAA6C+B,QAAQM,SAArD;AACH;;AAED,gBAAIL,OAAJ,EAAa;AACT,qBAAK7B,oBAAL,CAA0B8B,MAA1B,GAAmCD,QAAQE,QAA3C;AACAC,gCAAMC,YAAN,CAAmB,KAAKhC,mBAAxB,EAA6C4B,QAAQK,SAArD;AACH;AACJ;AACJ;;AAED;;AA3EK,CAAT","file":"game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import roomManager from './room_manager';\n\nimport utils from './utils';\nimport dataManager from './data_manager';\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        labelPlayerATip: cc.Label,\n        labelPlayerANickName: cc.Label,\n        spritePlayerAAvatar: cc.Sprite,\n\n        labelPlayerBTip: cc.Label,\n        labelPlayerBNickName: cc.Label,\n        spritePlayerBAvatar: cc.Sprite,\n    },\n\n    start () {\n\n    },\n\n    onClickStopGame() { \n        roomManager.leave();\n        cc.director.loadScene('start');\n    },\n\n    onClickTalk() {\n        if (roomManager.room) {\n            roomManager.room.send(JSON.stringify({\n                event: 'talk',\n                data: parseInt(Math.random() * 100),\n            }));\n        }\n    },\n\n    onRoomMessage(messageStr) {\n        // NOTE: 消息体的内容是开发者自己定义的，这里的代码只是一种示例\n        // NOTE: 开发者可以根据自己的房间脚本和协议，实现自身游戏的逻辑\n        const message = JSON.parse(messageStr);\n\n        if (message.length) {\n            message.forEach(({ event, data }) => {\n                switch (event) {\n                    case 'environment':\n                        dataManager.environment = data;\n                        break;\n                    case 'info':\n                        dataManager.twoPlayersInfo = data;\n                        this.renderPlayers();\n                        break;\n                    case 'server-time':\n                        break;\n                    case 'talk':\n                        break;\n                    case 'end':\n                        break;\n                    default:\n                        break;\n                }\n            })\n        }\n    },\n\n    renderPlayers() {\n        if (dataManager.twoPlayersInfo) {\n            const [ playerA, playerB ] = dataManager.twoPlayersInfo;\n\n            if (playerA) {\n                this.labelPlayerANickName.string = playerA.nickName;\n                utils.renderAvatar(this.spritePlayerAAvatar, playerA.avatarUrl);\n            }\n\n            if (playerB) {\n                this.labelPlayerBNickName.string = playerB.nickName;\n                utils.renderAvatar(this.spritePlayerBAvatar, playerB.avatarUrl);\n            }\n        }\n    }\n\n    // update (dt) {},\n});\n"]}