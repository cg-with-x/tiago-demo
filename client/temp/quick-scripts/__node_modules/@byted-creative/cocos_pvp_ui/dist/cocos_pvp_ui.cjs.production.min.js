(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/cocos_pvp_ui/dist/cocos_pvp_ui.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'cocos_pvp_ui.cjs.production.min', __filename);"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@byted-creative/pvp_microphone"),t=require("@byted-creative/live_ui_source");function i(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function n(e,t){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var o,r,a=[t.BACKGROUNDIMG,t.DEFAULTAVATAR,t.AVATARBGMIN,t.AVATARBGMID,t.AVATARBGMAX,t.LITTLECIRCLE,t.BIGCIRCLE,t.MATCHIMG,t.MATCHSUCCESS,t.LEAVEBTN,t.REDCIRCLE,t.ZHIBOZHONG];!function(e){e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.FIVE=5]="FIVE",e[e.SIX=6]="SIX",e[e.SEVEN=7]="SEVEN",e[e.EIGHT=8]="EIGHT",e[e.NINE=9]="NINE"}(o||(o={})),function(e){e[e.BACKGROUNDIMG=0]="BACKGROUNDIMG",e[e.DEFAULTAVATAR=1]="DEFAULTAVATAR",e[e.AVATARBGMIN=2]="AVATARBGMIN",e[e.AVATARBGMID=3]="AVATARBGMID",e[e.AVATARBGMAX=4]="AVATARBGMAX",e[e.LITTLECIRCLE=5]="LITTLECIRCLE",e[e.BIGCIRCLE=6]="BIGCIRCLE",e[e.MATCHIMG=7]="MATCHIMG",e[e.MATCHSUCCESS=8]="MATCHSUCCESS",e[e.LEAVEBTN=9]="LEAVEBTN",e[e.REDCIRCLE=10]="REDCIRCLE",e[e.ZHIBOZHONG=11]="ZHIBOZHONG"}(r||(r={}));var s,c=function(){function e(){this._avatars=[],this._lastFrameTime=0,this._deltaTime=0,this._tipUpdateGap=0,this._delayClose=0,this._loadingNodes=[],this._myOpenId="",this._closeResolve=null,this._avartarLayout={2:[{x:-168,y:35},{x:168,y:35}],3:[{x:-230,y:20},{x:0,y:20},{x:230,y:20}],4:[{x:-250,y:20},{x:-80,y:20},{x:80,y:20},{x:250,y:20}],5:[{x:-230,y:120},{x:0,y:120},{x:230,y:120},{x:-120,y:-80},{x:120,y:-80}],6:[{x:-230,y:120},{x:0,y:120},{x:230,y:120},{x:-230,y:-80},{x:0,y:-80},{x:230,y:-80}],7:[{x:-250,y:120},{x:-80,y:120},{x:80,y:120},{x:250,y:120},{x:-160,y:-80},{x:0,y:-80},{x:160,y:-80}],8:[{x:-250,y:120},{x:-80,y:120},{x:80,y:120},{x:250,y:120},{x:-250,y:-80},{x:-80,y:-80},{x:80,y:-80},{x:250,y:-80}],9:[{x:-230,y:240},{x:0,y:240},{x:230,y:240},{x:-230,y:15},{x:0,y:15},{x:230,y:15},{x:-230,y:-180},{x:0,y:-180},{x:230,y:-180}]},this._bgType={2:r.AVATARBGMIN,3:r.AVATARBGMIN,4:r.AVATARBGMIN,5:r.AVATARBGMID,6:r.AVATARBGMID,7:r.AVATARBGMID,8:r.AVATARBGMID,9:r.AVATARBGMAX}}return Object.defineProperty(e,"instance",{get:function(){return e._instance=new e,console.log("no one instance"),e._instance},enumerable:!1,configurable:!0}),e.prototype.createUI=function(){return i(this,void 0,void 0,(function(){var t,i,o,s,c,h,d,l,p,u=this;return n(this,(function(n){switch(n.label){case 0:if(this._matchUI)return[2];for(t=cc.view.getVisibleSize(),e._scale=t.width/t.height>1125/2001?t.height/2001:t.width/1125,i=cc.director.getScene().getChildByName("Canvas"),this._canvas=i,this._matchUI=new cc.Node("matchUI"),this._canvas.addChild(this._matchUI),this._matchUI.width=1125,this._matchUI.height=2001,this._matchUI.setSiblingIndex(Number.MAX_VALUE),this._matchUI.setPosition(this._canvas.width*(.5-this._canvas.anchorX),this._canvas.height*(.5-this._canvas.anchorY)),(o=new cc.Node("bg")).addComponent(cc.Sprite),this._matchUI.addChild(o),o.on(cc.Node.EventType.TOUCH_END,(function(e){e&&e.stopPropagation()})),s=new cc.Node("avatarBG"),(c=s.addComponent(cc.Sprite)).type=cc.Sprite.Type.SIMPLE,c.sizeMode=cc.Sprite.SizeMode.RAW,this._matchUI.addChild(s),h=new cc.Node("tipSprite"),this._tipSprite=h.addComponent(cc.Sprite),this._matchUI.addChild(h),this._loadingNodeParent=new cc.Node("loadingNodeParent"),this._matchUI.addChild(this._loadingNodeParent),l=0;l<5;l++)(d=new cc.Node("loadingNode"+l)).addComponent(cc.Sprite),this._loadingNodeParent.addChild(d),this._loadingNodes.push(d);for(l=0;l<9;l++)p=this.createAvatarNode(this._matchUI),this._avatars.push(p);return this._matchUI.active=!1,[4,this.loadImages(a).then((function(e){if(u._spriteFrames=e,u._matchUI){u._matchUI.width=i.width,u._matchUI.height=i.height;var t=u._matchUI.getChildByName("bg");t.getComponent(cc.Sprite).spriteFrame=e[r.BACKGROUNDIMG],t.getComponent(cc.Sprite).type=cc.Sprite.Type.SIMPLE,t.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.CUSTOM,t.width=i.width,t.height=i.height;for(var n=0;n<u._loadingNodes.length;n++)u._loadingNodes[n].getComponent(cc.Sprite).spriteFrame=e[r.LITTLECIRCLE],u._loadingNodes[n].getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW,u._loadingNodes[n].setPosition(64-32*(4-n),0)}for(n=0;n<u._avatars.length;n++){var o=u._avatars[n].getChildByName("mask").getChildByName("sprite");o.getComponent(cc.Sprite).spriteFrame=e[r.DEFAULTAVATAR],o.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var a=u._avatars[n].getChildByName("circle");a.getComponent(cc.Sprite).spriteFrame=e[r.REDCIRCLE],a.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var s=a.getChildByName("zhibozhong");s.getComponent(cc.Sprite).spriteFrame=e[r.ZHIBOZHONG],s.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var c=u._avatars[n].getChildByName("label");c.getComponent(cc.Label).string="等待中",c.getComponent(cc.Label).fontSize=26}}))];case 1:return n.sent(),[2]}}))}))},e.prototype.loadImages=function(t){return i(this,void 0,void 0,(function(){return n(this,(function(i){return[2,Promise.all(t.map((function(t,i){return new Promise((function(n){var o=new window.Image;o.crossOrigin="anonymous",o.onload=function(){var t=new cc.Texture2D;t.initWithElement(o),t.handleLoadedTexture();var r=new cc.SpriteFrame(t);r.name=i.toString();var a=r.getOriginalSize();r.setOriginalSize(new cc.Size(a.width*e._scale,a.height*e._scale)),n(r)},o.src=t}))})))]}))}))},e.prototype.update=function(){if(this._matchUI&&this._matchUI.active){if(this._deltaTime=16,this._lastFrameTime&&(this._deltaTime=Date.now()-this._lastFrameTime),this._delayClose&&(this._delayClose-=this._deltaTime,this._delayClose<=0&&(this._delayClose=0,this.close())),this._tipUpdateGap+=this._deltaTime,this._tipSprite&&this._tipUpdateGap>=300&&this._spriteFrames){this._tipUpdateGap=0;for(var e=0;e<this._loadingNodes.length;e++){var t=this._loadingNodes[e].getComponent(cc.Sprite);if(t.spriteFrame.name===this._spriteFrames[r.BIGCIRCLE].name){t.spriteFrame=this._spriteFrames[r.LITTLECIRCLE],e++;break}}this._loadingNodes[e%=this._loadingNodes.length].getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.BIGCIRCLE]}this._lastFrameTime=Date.now(),window.requestAnimationFrame(this.update.bind(this))}},e.prototype.show=function(t,o,a){return void 0===a&&(a=!1),i(this,void 0,void 0,(function(){var i,s,c,h,d;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this._delayClose=0,console.log("show info",t,o,a),this._matchUI?[3,2]:[4,e._instance.createUI()];case 1:n.sent(),n.label=2;case 2:return a?[4,this.createDebugUI()]:[3,4];case 3:n.sent(),n.label=4;case 4:if(t<=1&&t>=10)return[2];for(this.resetAvatar(),s=0;s<this._avatars.length;s++)this._avatars[s].active=s<t;if(this._loadingNodeParent&&(this._loadingNodeParent.active=!0),this._spriteFrames)for(s=0;s<this._loadingNodes.length;s++)this._loadingNodes[s].getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.LITTLECIRCLE];if(this._avartarLayout[t])for(i=this._avartarLayout[t],s=0;s<i.length;s++)this._avatars[s].setPosition(i[s].x,i[s].y);return this._matchUI&&this._tipSprite&&this._spriteFrames&&this._loadingNodeParent&&(c=this._bgType[t]||r.AVATARBGMIN,(h=this._matchUI.getChildByName("avatarBG")).getComponent(cc.Sprite).spriteFrame=this._spriteFrames[c],this._tipSprite.node.setPosition(this._tipSprite.node.position.x,h.height/2+150),this._loadingNodeParent.setPosition(this._tipSprite.node.position.x,h.height/2+80)),this._matchUI&&this._tipSprite&&this._spriteFrames&&(this._tipSprite.spriteFrame=this._spriteFrames[r.MATCHIMG],this._tipSprite.type=cc.Sprite.Type.SIMPLE,this._tipSprite.sizeMode=cc.Sprite.SizeMode.RAW,this._matchUI.active=!0),this._myOpenId=o.openId,this.setAvatar(0,o),window.requestAnimationFrame(this.update.bind(this)),[3,6];case 5:return d=n.sent(),console.log("show ui error",d),[3,6];case 6:return[2]}}))}))},e.prototype.createDebugUI=function(){return i(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return h.debugUI?[2,!1]:[4,h.createUI()];case 1:return n.sent(),e=cc.director.getScene().getChildByName("Canvas"),i=new cc.Node("debugButton"),e.addChild(i),i.addComponent(cc.Button),i.addComponent(cc.Sprite),i.on("click",this.onDebugClick,this),i.width=100,i.height=50,o=new cc.Node("debugLabel"),i.addChild(o),o.addComponent(cc.Label),o.getComponent(cc.Label).string="vConsole",[4,this.loadImages([t.WHITETEXTURE]).then((function(t){var n=i.getComponent(cc.Sprite);n.spriteFrame=t[0],n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,i.width=200,i.height=60,i.color=cc.Color.GREEN,i.setPosition(-e.anchorX*e.width+i.width/2,-e.anchorY*e.height+i.height/2)}))];case 2:return n.sent(),[2]}}))}))},e.prototype.onDebugClick=function(){h.isOpen()?h.close():h.show()},e.prototype.whenClosed=function(){return this._closePromise},e.prototype.matchSuccess=function(e){return i(this,void 0,void 0,(function(){var t,i,o=this;return n(this,(function(n){switch(n.label){case 0:return this._closePromise=new Promise((function(e){return o._closeResolve=e})),[4,this.playMatchSuccess()];case 1:for(n.sent(),this._delayClose=3e3,t=null,i=0;i<e.length;i++)if(e[i].extraInfo.openId===this._myOpenId){t=e.splice(i,1);break}if(t)for(i=0;i<e.length;i++)t.push(e[i]);else t=e;for(i=0;i<t.length;i++)this.setAvatar(i,t[i].extraInfo);return[2]}}))}))},e.prototype.playMatchSuccess=function(){return i(this,void 0,void 0,(function(){var e=this;return n(this,(function(t){return[2,new Promise((function(t){var i=cc.callFunc((function(){e._tipSprite&&e._spriteFrames&&(e._tipSprite.spriteFrame=e._spriteFrames[r.MATCHSUCCESS]),e._loadingNodeParent&&(e._loadingNodeParent.active=!1)})),n=cc.callFunc((function(){t()})),o=cc.sequence(cc.scaleTo(.2,0,0),i,cc.scaleTo(.2,1,1),n);e._tipSprite&&e._tipSprite.node&&e._tipSprite.node.runAction(o)}))]}))}))},e.prototype.setAvatar=function(e,t){var i=this;if(!(e>=this._avatars.length)){var n=t.nickName,o=t.avatarUrl,r=t.isAnchor;if(n){var a=this._avatars[e].getChildByName("mask").getChildByName("sprite"),s=this._avatars[e].getChildByName("label").getComponent(cc.Label),c=this.formatName(n,1.2*a.width);s.string=c}this._avatars[e].getChildByName("circle").active=r,o&&this.loadImages([o]).then((function(t){if(t.length){var n=i._avatars[e].getChildByName("mask").getChildByName("sprite").getComponent(cc.Sprite),o=n.node.width,r=n.node.height;n.spriteFrame=t[0],n.sizeMode=cc.Sprite.SizeMode.CUSTOM,n.node.width=o,n.node.height=r}}))}},e.prototype.resetAvatar=function(){if(this._spriteFrames&&this._avatars)for(var e=0;e<this._avatars.length;e++){var t=this._avatars[e]&&this._avatars[e].getChildByName("mask"),i=t&&t.getChildByName("sprite");i&&(i.getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.DEFAULTAVATAR],i.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW);var n=this._avatars[e]&&this._avatars[e].getChildByName("circle");n&&(n.active=!1);var o=this._avatars[e]&&this._avatars[e].getChildByName("label");o&&o.getComponent(cc.Label)&&(o.getComponent(cc.Label).string="等待中")}},e.prototype.formatName=function(e,t){for(var i=new RegExp("[一-龥]+"),n=0,o=0;o<e.length;o++)if(i.test(e[o])?n+=30:n+=17,n>t)return e.slice(0,o)+"...";return e},e.prototype.close=function(){this.resetAvatar(),this._matchUI&&(this._matchUI.active=!1),this._closeResolve&&this._closeResolve()},e.prototype.onClose=function(){this._closeCallback&&this._closeCallback(),this.close()},e.prototype.setCloseEvent=function(e){this._closeCallback=e},e.prototype.createAvatarNode=function(t){var i=new cc.Node;i.width=120,i.height=180,t.addChild(i);var n=new cc.Node("mask"),o=n.addComponent(cc.Mask);i.addChild(n),n.width=180*e._scale,n.height=180*e._scale,o.type=cc.Mask.Type.ELLIPSE;var r=new cc.Node("sprite");r.addComponent(cc.Sprite),n.addChild(r);var a=new cc.Node("circle");a.addComponent(cc.Sprite),i.addChild(a),a.active=!1;var s=new cc.Node("zhibozhong");s.addComponent(cc.Sprite),a.addChild(s),s.setPosition(0,-55);var c=new cc.Node("label");return c.addComponent(cc.Label),i.addChild(c),c.anchorY=1,c.setPosition(0,-80),i},e._scale=1,e}(),h=function(){function e(){}return e.createUI=function(){return i(this,void 0,void 0,(function(){var i,o,r,a,s,c,h,d,l,p=this;return n(this,(function(n){switch(n.label){case 0:return e._debugUI?[2]:(i=cc.director.getScene().getChildByName("Canvas"),this._debugUI=new cc.Node,this.debugUI=this._debugUI,i.addChild(this._debugUI),this._debugUI.width=400,this._debugUI.height=400,this._debugUI.setSiblingIndex(Number.MAX_VALUE),this._debugUI.setPosition(this._debugUI.width*(.5-i.anchorX),this._debugUI.height*(.5-i.anchorY)),(o=new cc.Node("bg")).addComponent(cc.Sprite),this._debugUI.addChild(o),r=new cc.Node("scrollView").addComponent(cc.ScrollView),this._debugUI.addChild(r.node),r.node.width=r.node.parent.width,r.node.height=r.node.parent.height,r.horizontal=!1,r.vertical=!0,(a=new cc.Node("view")).addComponent(cc.Mask),r.node.addChild(a),a.width=a.parent.width,a.height=a.parent.height,s=new cc.Node("content"),a.addChild(s),r.content=s,s.width=a.width,(c=s.addComponent(cc.Layout)).type=cc.Layout.Type.VERTICAL,c.resizeMode=cc.Layout.ResizeMode.CONTAINER,h=new cc.Node("label"),this._debugLabel=h.addComponent(cc.RichText),s.addChild(h),this._debugLabel.node.color=cc.Color.BLACK,h.width=h.parent.width,this._debugLabel.fontSize=32,this._debugLabel.lineHeight=40,d=new cc.Node("clearButton"),this._debugUI.addChild(d),d.addComponent(cc.Button),d.addComponent(cc.Sprite),d.color=cc.Color.GREEN,d.on("click",e.clearLog,e),d.width=100,d.height=50,l=new cc.Node("clearLabel"),d.addChild(l),l.addComponent(cc.Label),l.getComponent(cc.Label).string="clear",[4,this.loadImages([t.WHITETEXTURE]).then((function(e){p._debugUI.width=i.width,p._debugUI.height=i.height;var t=p._debugUI.getChildByName("bg");t.getComponent(cc.Sprite).spriteFrame=e[0],t.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.CUSTOM,t.width=t.parent.width,t.height=t.parent.height,r.node.width=r.node.parent.width,r.node.height=r.node.parent.height,a.width=a.parent.width,a.height=a.parent.height,s.width=s.parent.width-50,h.width=h.parent.width,p._debugLabel.maxWidth=h.width;var n=d.getComponent(cc.Sprite);n.spriteFrame=e[0],n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,d.width=180,d.height=60,d.color=cc.Color.GREEN,d.setPosition(i.width*(.5-i.anchorX),-i.anchorY*i.height+d.height/2)}))]);case 1:return n.sent(),this._debugUI.active=!1,[2]}}))}))},e.clearLog=function(){this._logString="",this._debugLabel.string=""},e.loadImages=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return[2,Promise.all(e.map((function(e){return new Promise((function(t){var i=new window.Image;i.onload=function(){var e=new cc.Texture2D;e.initWithElement(i),e.handleLoadedTexture(),t(new cc.SpriteFrame(e))},i.src=e}))})))]}))}))},e.show=function(){return i(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._debugUI?[3,2]:[4,this.createUI()];case 1:e.sent(),e.label=2;case 2:return this._debugLabel.string=this._logString,this._debugUI.active=!0,[2]}}))}))},e.close=function(){this._debugUI.active=!1},e.isOpen=function(){return this._debugUI.active},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logString&&(this._logString+="\n"),this._logString+="<color=#000000>";for(var i=0;i<e.length;i++)if(Array.isArray(e[i]))for(var n=e[i],o=0;o<n.length;o++)this._logString+="string"==typeof n[o]?n[o]:JSON.stringify(n[o],this.replace),this._seen=[],this._logString+=" ";else this._logString+="string"==typeof e[i]?e[i]:JSON.stringify(e[i],this.replace),this._seen=[],this._logString+=" ";this._logString+="</color>"},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logString&&(this._logString+="\n"),this._logString+="<color=#ff0000>";for(var i=0;i<e.length;i++)if(Array.isArray(e[i]))for(var n=e[i],o=0;o<n.length;o++)this._logString+="string"==typeof n[o]?n[o]:JSON.stringify(n[o],this.replace),this._seen=[],this._logString+=" ";else this._logString+="string"==typeof e[i]?e[i]:JSON.stringify(e[i],this.replace),this._seen=[],this._logString+=" ";this._logString+="</color>"},e.replace=function(t,i){if(null!=i&&"object"==typeof i){if(e._seen.indexOf(i)>=0)return;e._seen.push(i)}return i},e._logString="",e._seen=[],e}();!function(e){e[e.MICMYOPEN=0]="MICMYOPEN",e[e.MICMYCLOSE=1]="MICMYCLOSE",e[e.MICOTHEROPEN=2]="MICOTHEROPEN",e[e.MICOTHERCLOSE=3]="MICOTHERCLOSE"}(s||(s={}));var d=function(){function o(){}return o.createUI=function(){return i(this,void 0,void 0,(function(){var e,i,r,a,c=this;return n(this,(function(n){switch(n.label){case 0:return o._microphoneUI?[2]:(e=cc.view.getVisibleSize(),o._scale=e.width/e.height>1125/2001?e.height/2001:e.width/1125,i=cc.director.getScene().getChildByName("Canvas"),this._microphoneUI=new cc.Node("microphoneUI"),this._microphoneUI.width=200,this._microphoneUI.height=64,i.addChild(this._microphoneUI),this._microphoneUI.setSiblingIndex(Number.MAX_VALUE),this._microphoneUI.setPosition((1-i.anchorX)*i.width-this._microphoneUI.width/2,(1-i.anchorY)*i.height-this._microphoneUI.height/2),r=new cc.Node("myBtn"),this._microphoneUI.addChild(r),r.addComponent(cc.Button),r.setPosition(-50,-40),r.getComponent(cc.Button).transition=cc.Button.Transition.SCALE,r.getComponent(cc.Button).zoomScale=.8,r.getComponent(cc.Button).duration=.1,this._mySprite=r.addComponent(cc.Sprite),r.on("click",this.clickMyChat,this),a=new cc.Node("otherBtn"),this._microphoneUI.addChild(a),a.setPosition(50,-40),a.addComponent(cc.Button),a.getComponent(cc.Button).transition=cc.Button.Transition.SCALE,a.getComponent(cc.Button).zoomScale=.8,a.getComponent(cc.Button).duration=.1,this._otherSprite=a.addComponent(cc.Sprite),a.on("click",this.clickOtherChat,this),this._microphoneUI.active=!1,[4,this.loadImages([t.MICMYOPEN,t.MICMYCLOSE,t.MICOTHEROPEN,t.MICOTHERCLOSE]).then((function(e){c._spriteFrames=e,c._mySprite.spriteFrame=e[s.MICMYOPEN],c._otherSprite.spriteFrame=e[s.MICOTHEROPEN],c._mySprite.sizeMode=cc.Sprite.SizeMode.RAW,c._otherSprite.sizeMode=cc.Sprite.SizeMode.RAW,c._microphoneUI.setPosition((1-i.anchorX)*i.width-c._microphoneUI.width/2,(1-i.anchorY)*i.height-c._microphoneUI.height/2)}))]);case 1:return n.sent(),[2]}}))}))},o.loadImages=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return[2,Promise.all(e.map((function(e){return new Promise((function(t){var i=new window.Image;i.onload=function(){var e=new cc.Texture2D;e.initWithElement(i),e.handleLoadedTexture();var n=new cc.SpriteFrame(e),r=n.getOriginalSize();n.setOriginalSize(new cc.Size(r.width*o._scale,r.height*o._scale)),t(n)},i.src=e}))})))]}))}))},o.show=function(t){return i(this,void 0,void 0,(function(){var i;return n(this,(function(n){switch(n.label){case 0:return this._microphoneUI?[3,2]:[4,this.createUI()];case 1:n.sent(),n.label=2;case 2:return[4,e.PVPMicrophone.init({openID:t.openID,roomNum:t.roomNum,appID:t.appID,source:t.source})];case 3:n.sent(),console.log("init success"),n.label=4;case 4:return n.trys.push([4,6,,7]),console.log("start chat"),[4,e.PVPMicrophone.startChat()];case 5:return n.sent(),[3,7];case 6:return i=n.sent(),console.error("start chat",i),[2];case 7:return console.log("startChat success"),this._isMyOpen=e.PVPMicrophone.getAudioStatus().local,this._isOtherOpen=e.PVPMicrophone.getAudioStatus().remote,this._microphoneUI.active=!0,this._mySprite.spriteFrame=this._isMyOpen?this._spriteFrames[s.MICMYOPEN]:this._spriteFrames[s.MICMYCLOSE],this._otherSprite.spriteFrame=this._isOtherOpen?this._spriteFrames[s.MICOTHEROPEN]:this._spriteFrames[s.MICOTHERCLOSE],[2]}}))}))},o.close=function(){this._microphoneUI&&(console.log("close cocos microphone ui"),this._microphoneUI.active=!1,e.PVPMicrophone.endChat())},o.clickMyChat=function(){var t=this;this._isMyOpen?e.PVPMicrophone.disableLocalAudio().then((function(){t._isMyOpen=!1,t._mySprite.spriteFrame=t._spriteFrames[s.MICMYCLOSE],console.log("disableLocalAudio success")})).catch((function(e){console.error("disableLocalAudio error",e)})):e.PVPMicrophone.enableLocalAudio().then((function(){t._isMyOpen=!0,t._mySprite.spriteFrame=t._spriteFrames[s.MICMYOPEN],console.log("enableLocalAudio success")})).catch((function(e){console.error("enableLocalAudio error",e)}))},o.clickOtherChat=function(){var t=this;this._isOtherOpen?e.PVPMicrophone.muteAllRemoteAudioStream().then((function(){t._isOtherOpen=!1,t._otherSprite.spriteFrame=t._spriteFrames[s.MICOTHERCLOSE],console.log("muteAllRemoteAudioStream success")})).catch((function(e){console.error("muteAllRemoteAudioStream error",e)})):e.PVPMicrophone.unmuteAllRemoteAudioStream().then((function(){t._isOtherOpen=!0,t._otherSprite.spriteFrame=t._spriteFrames[s.MICOTHEROPEN],console.log("unmuteAllRemoteAudioStream success")})).catch((function(e){console.error("unmuteAllRemoteAudioStream error",e)}))},o._isMyOpen=!1,o._isOtherOpen=!1,o._scale=1,o}();exports.DebugUI=h,exports.MicrophoneUI=d,exports.default=c;

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        