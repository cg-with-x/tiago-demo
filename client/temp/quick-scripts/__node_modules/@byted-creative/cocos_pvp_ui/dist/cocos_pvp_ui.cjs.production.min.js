(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/cocos_pvp_ui/dist/cocos_pvp_ui.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'cocos_pvp_ui.cjs.production.min', __filename);"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@byted-creative/pvp_microphone"),t=require("@byted-creative/live_ui_source");function i(e,t,i,o){return new(i||(i=Promise))((function(n,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))}function o(e,t){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}}var n,r,s=[t.BACKGROUNDIMG,t.DEFAULTAVATAR,t.AVATARBGMIN,t.AVATARBGMID,t.AVATARBGMAX,t.LITTLECIRCLE,t.BIGCIRCLE,t.MATCHIMG,t.MATCHSUCCESS,t.LEAVEBTN,t.REDCIRCLE,t.ZHIBOZHONG];!function(e){e[e.TWO=2]="TWO",e[e.THREE=3]="THREE",e[e.FOUR=4]="FOUR",e[e.FIVE=5]="FIVE",e[e.SIX=6]="SIX",e[e.SEVEN=7]="SEVEN",e[e.EIGHT=8]="EIGHT",e[e.NINE=9]="NINE"}(n||(n={})),function(e){e[e.BACKGROUNDIMG=0]="BACKGROUNDIMG",e[e.DEFAULTAVATAR=1]="DEFAULTAVATAR",e[e.AVATARBGMIN=2]="AVATARBGMIN",e[e.AVATARBGMID=3]="AVATARBGMID",e[e.AVATARBGMAX=4]="AVATARBGMAX",e[e.LITTLECIRCLE=5]="LITTLECIRCLE",e[e.BIGCIRCLE=6]="BIGCIRCLE",e[e.MATCHIMG=7]="MATCHIMG",e[e.MATCHSUCCESS=8]="MATCHSUCCESS",e[e.LEAVEBTN=9]="LEAVEBTN",e[e.REDCIRCLE=10]="REDCIRCLE",e[e.ZHIBOZHONG=11]="ZHIBOZHONG"}(r||(r={}));var c,a=function(){function e(){this._avatars=[],this._lastFrameTime=0,this._deltaTime=0,this._tipUpdateGap=0,this._delayClose=0,this._loadingNodes=[],this._myOpenId="",this._closeResolve=null,this._avartarLayout={2:[{x:-168,y:35},{x:168,y:35}],3:[{x:-230,y:20},{x:0,y:20},{x:230,y:20}],4:[{x:-250,y:20},{x:-80,y:20},{x:80,y:20},{x:250,y:20}],5:[{x:-230,y:120},{x:0,y:120},{x:230,y:120},{x:-120,y:-80},{x:120,y:-80}],6:[{x:-230,y:120},{x:0,y:120},{x:230,y:120},{x:-230,y:-80},{x:0,y:-80},{x:230,y:-80}],7:[{x:-250,y:120},{x:-80,y:120},{x:80,y:120},{x:250,y:120},{x:-160,y:-80},{x:0,y:-80},{x:160,y:-80}],8:[{x:-250,y:120},{x:-80,y:120},{x:80,y:120},{x:250,y:120},{x:-250,y:-80},{x:-80,y:-80},{x:80,y:-80},{x:250,y:-80}],9:[{x:-230,y:240},{x:0,y:240},{x:230,y:240},{x:-230,y:15},{x:0,y:15},{x:230,y:15},{x:-230,y:-180},{x:0,y:-180},{x:230,y:-180}]},this._bgType={2:r.AVATARBGMIN,3:r.AVATARBGMIN,4:r.AVATARBGMIN,5:r.AVATARBGMID,6:r.AVATARBGMID,7:r.AVATARBGMID,8:r.AVATARBGMID,9:r.AVATARBGMAX}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),e.prototype.createUI=function(){return i(this,void 0,void 0,(function(){var t,i,n,c,a,h,d,l,p,u=this;return o(this,(function(o){switch(o.label){case 0:if(this._matchUI)return[2];for(t=cc.view.getVisibleSize(),e._scale=t.width/t.height>1125/2001?t.height/2001:t.width/1125,i=cc.director.getScene().getChildByName("Canvas"),this._canvas=i,this._matchUI=new cc.Node("matchUI"),cc.director.getScene().addChild(this._matchUI),cc.game.addPersistRootNode(this._matchUI),this._matchUI.width=1125,this._matchUI.height=2001,this._matchUI.setSiblingIndex(Number.MAX_VALUE),this._matchUI.setPosition(this._canvas.width*(1-this._canvas.anchorX),this._canvas.height*(1-this._canvas.anchorY)),(n=new cc.Node("bg")).addComponent(cc.Sprite),this._matchUI.addChild(n),n.on(cc.Node.EventType.TOUCH_END,(function(e){e&&e.stopPropagation()})),c=new cc.Node("avatarBG"),(a=c.addComponent(cc.Sprite)).type=cc.Sprite.Type.SIMPLE,a.sizeMode=cc.Sprite.SizeMode.RAW,this._matchUI.addChild(c),h=new cc.Node("tipSprite"),this._tipSprite=h.addComponent(cc.Sprite),this._matchUI.addChild(h),this._loadingNodeParent=new cc.Node("loadingNodeParent"),this._matchUI.addChild(this._loadingNodeParent),l=0;l<5;l++)(d=new cc.Node("loadingNode"+l)).addComponent(cc.Sprite),this._loadingNodeParent.addChild(d),this._loadingNodes.push(d);for(l=0;l<9;l++)p=this.createAvatarNode(this._matchUI),this._avatars.push(p);return this._matchUI.active=!1,[4,this.loadImages(s).then((function(e){if(u._spriteFrames=e,u._matchUI){u._matchUI.width=i.width,u._matchUI.height=i.height;var t=u._matchUI.getChildByName("bg");t.getComponent(cc.Sprite).spriteFrame=e[r.BACKGROUNDIMG],t.getComponent(cc.Sprite).type=cc.Sprite.Type.SIMPLE,t.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.CUSTOM,t.width=i.width,t.height=i.height;for(var o=0;o<u._loadingNodes.length;o++)u._loadingNodes[o].getComponent(cc.Sprite).spriteFrame=e[r.LITTLECIRCLE],u._loadingNodes[o].getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW,u._loadingNodes[o].setPosition(64-32*(4-o),0)}for(o=0;o<u._avatars.length;o++){var n=u._avatars[o].getChildByName("mask").getChildByName("sprite");n.getComponent(cc.Sprite).spriteFrame=e[r.DEFAULTAVATAR],n.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var s=u._avatars[o].getChildByName("circle");s.getComponent(cc.Sprite).spriteFrame=e[r.REDCIRCLE],s.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var c=s.getChildByName("zhibozhong");c.getComponent(cc.Sprite).spriteFrame=e[r.ZHIBOZHONG],c.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW;var a=u._avatars[o].getChildByName("label");a.getComponent(cc.Label).string="等待中",a.getComponent(cc.Label).fontSize=26}}))];case 1:return o.sent(),[2]}}))}))},e.prototype.loadImages=function(t){return i(this,void 0,void 0,(function(){return o(this,(function(i){return[2,Promise.all(t.map((function(t,i){return new Promise((function(o){var n=new window.Image;n.crossOrigin="anonymous",n.onload=function(){var t=new cc.Texture2D;t.initWithElement(n),t.handleLoadedTexture();var r=new cc.SpriteFrame(t);r.name=i.toString();var s=r.getOriginalSize();r.setOriginalSize(new cc.Size(s.width*e._scale,s.height*e._scale)),o(r)},n.src=t}))})))]}))}))},e.prototype.update=function(){if(this._matchUI&&this._matchUI.active){if(this._deltaTime=16,this._lastFrameTime&&(this._deltaTime=Date.now()-this._lastFrameTime),this._delayClose&&(this._delayClose-=this._deltaTime,this._delayClose<=0&&(this._delayClose=0,this.close())),this._tipUpdateGap+=this._deltaTime,this._tipSprite&&this._tipUpdateGap>=300&&this._spriteFrames){this._tipUpdateGap=0;for(var e=0;e<this._loadingNodes.length;e++){var t=this._loadingNodes[e].getComponent(cc.Sprite);if(t.spriteFrame.name===this._spriteFrames[r.BIGCIRCLE].name){t.spriteFrame=this._spriteFrames[r.LITTLECIRCLE],e++;break}}this._loadingNodes[e%=this._loadingNodes.length].getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.BIGCIRCLE]}this._lastFrameTime=Date.now(),window.requestAnimationFrame(this.update.bind(this))}},e.prototype.show=function(t,n,s){return void 0===s&&(s=!1),i(this,void 0,void 0,(function(){var i,c,a,h;return o(this,(function(o){switch(o.label){case 0:return console.log("show info",t,n,s),this._delayClose=0,this._matchUI?[3,2]:[4,e._instance.createUI()];case 1:o.sent(),o.label=2;case 2:return s?[4,this.createDebugUI()]:[3,4];case 3:o.sent(),o.label=4;case 4:if(t<=1&&t>=10)return[2];for(this.resetAvatar(),c=0;c<this._avatars.length;c++)this._avatars[c].active=c<t;if(this._loadingNodeParent&&(this._loadingNodeParent.active=!0),this._spriteFrames)for(c=0;c<this._loadingNodes.length;c++)this._loadingNodes[c].getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.LITTLECIRCLE];if(this._avartarLayout[t])for(i=this._avartarLayout[t],c=0;c<i.length;c++)this._avatars[c].setPosition(i[c].x,i[c].y);return this._matchUI&&this._tipSprite&&this._spriteFrames&&this._loadingNodeParent&&(a=this._bgType[t]||r.AVATARBGMIN,(h=this._matchUI.getChildByName("avatarBG")).getComponent(cc.Sprite).spriteFrame=this._spriteFrames[a],this._tipSprite.node.setPosition(this._tipSprite.node.position.x,h.height/2+150),this._loadingNodeParent.setPosition(this._tipSprite.node.position.x,h.height/2+80)),this._matchUI&&this._tipSprite&&this._spriteFrames&&(this._tipSprite.spriteFrame=this._spriteFrames[r.MATCHIMG],this._tipSprite.type=cc.Sprite.Type.SIMPLE,this._tipSprite.sizeMode=cc.Sprite.SizeMode.RAW,this._matchUI.active=!0),this._myOpenId=n.openId,this.setAvatar(0,n),window.requestAnimationFrame(this.update.bind(this)),[2]}}))}))},e.prototype.createDebugUI=function(){return i(this,void 0,void 0,(function(){var e,i;return o(this,(function(o){switch(o.label){case 0:return h.debugUI?[2,!1]:[4,h.createUI()];case 1:return o.sent(),e=new cc.Node("debugButton"),cc.director.getScene().addChild(e),cc.game.addPersistRootNode(e),e.addComponent(cc.Button),e.addComponent(cc.Sprite),e.on("click",this.onDebugClick,this),e.width=100,e.height=50,i=new cc.Node("debugLabel"),e.addChild(i),i.addComponent(cc.Label),i.getComponent(cc.Label).string="vConsole",[4,this.loadImages([t.WHITETEXTURE]).then((function(t){var i=e.getComponent(cc.Sprite);i.spriteFrame=t[0],i.type=cc.Sprite.Type.SLICED,i.sizeMode=cc.Sprite.SizeMode.CUSTOM,e.width=200,e.height=60,e.color=cc.Color.GREEN,e.setPosition(e.width/2,e.height/2)}))];case 2:return o.sent(),[2]}}))}))},e.prototype.onDebugClick=function(){h.isOpen()?h.close():h.show()},e.prototype.whenClosed=function(){return this._closePromise},e.prototype.matchSuccess=function(e){return i(this,void 0,void 0,(function(){var t,i,n=this;return o(this,(function(o){switch(o.label){case 0:return console.log("show player list",e),this._closePromise=new Promise((function(e){return n._closeResolve=e})),[4,this.playMatchSuccess()];case 1:for(o.sent(),this._delayClose=3e3,t=null,i=0;i<e.length;i++)if(e[i].extraInfo.openId===this._myOpenId){t=e.splice(i,1);break}if(t)for(i=0;i<e.length;i++)t.push(e[i]);else t=e;for(i=0;i<t.length;i++)this.setAvatar(i,t[i].extraInfo);return[2]}}))}))},e.prototype.playMatchSuccess=function(){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return[2,new Promise((function(t){var i=cc.callFunc((function(){e._tipSprite&&e._spriteFrames&&(e._tipSprite.spriteFrame=e._spriteFrames[r.MATCHSUCCESS]),e._loadingNodeParent&&(e._loadingNodeParent.active=!1)})),o=cc.callFunc((function(){t()})),n=cc.sequence(cc.scaleTo(.2,0,0),i,cc.scaleTo(.2,1,1),o);e._tipSprite&&e._tipSprite.node&&e._tipSprite.node.runAction(n)}))]}))}))},e.prototype.setAvatar=function(e,t){var i=this;if(!(e>=this._avatars.length)){var o=t.nickName,n=t.avatarUrl,r=t.isAnchor;if(o){var s=this._avatars[e].getChildByName("mask").getChildByName("sprite"),c=this._avatars[e].getChildByName("label").getComponent(cc.Label),a=this.formatName(o,1.2*s.width);c.string=a}this._avatars[e].getChildByName("circle").active=r,n&&this.loadImages([n]).then((function(t){if(t.length){var o=i._avatars[e].getChildByName("mask").getChildByName("sprite").getComponent(cc.Sprite),n=o.node.width,r=o.node.height;o.spriteFrame=t[0],o.sizeMode=cc.Sprite.SizeMode.CUSTOM,o.node.width=n,o.node.height=r}}))}},e.prototype.resetAvatar=function(){if(this._spriteFrames&&this._avatars)for(var e=0;e<this._avatars.length;e++){var t=this._avatars[e]&&this._avatars[e].getChildByName("mask"),i=t&&t.getChildByName("sprite");i&&(i.getComponent(cc.Sprite).spriteFrame=this._spriteFrames[r.DEFAULTAVATAR],i.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.RAW);var o=this._avatars[e]&&this._avatars[e].getChildByName("circle");o&&(o.active=!1);var n=this._avatars[e]&&this._avatars[e].getChildByName("label");n&&n.getComponent(cc.Label)&&(n.getComponent(cc.Label).string="等待中")}},e.prototype.formatName=function(e,t){for(var i=new RegExp("[一-龥]+"),o=0,n=0;n<e.length;n++)if(i.test(e[n])?o+=30:o+=17,o>t)return e.slice(0,n)+"...";return e},e.prototype.close=function(){this.resetAvatar(),this._matchUI&&(this._matchUI.active=!1),this._closeResolve&&this._closeResolve()},e.prototype.onClose=function(){this._closeCallback&&this._closeCallback(),this.close()},e.prototype.setCloseEvent=function(e){this._closeCallback=e},e.prototype.createAvatarNode=function(t){var i=new cc.Node;i.width=120,i.height=180,t.addChild(i);var o=new cc.Node("mask"),n=o.addComponent(cc.Mask);i.addChild(o),o.width=180*e._scale,o.height=180*e._scale,n.type=cc.Mask.Type.ELLIPSE;var r=new cc.Node("sprite");r.addComponent(cc.Sprite),o.addChild(r);var s=new cc.Node("circle");s.addComponent(cc.Sprite),i.addChild(s),s.active=!1;var c=new cc.Node("zhibozhong");c.addComponent(cc.Sprite),s.addChild(c),c.setPosition(0,-55);var a=new cc.Node("label");return a.addComponent(cc.Label),i.addChild(a),a.anchorY=1,a.setPosition(0,-80),i},e._scale=1,e}(),h=function(){function e(){}return e.createUI=function(){return i(this,void 0,void 0,(function(){var i,n,r,s,c,a,h,d,l,p=this;return o(this,(function(o){switch(o.label){case 0:return e._debugUI?[2]:(i=cc.director.getScene().getChildByName("Canvas"),this._debugUI=new cc.Node,this.debugUI=this._debugUI,cc.director.getScene().addChild(this._debugUI),cc.game.addPersistRootNode(this.debugUI),this._debugUI.width=400,this._debugUI.height=400,this._debugUI.setSiblingIndex(Number.MAX_VALUE),this._debugUI.setPosition(i.width/2,i.height/2),(n=new cc.Node("bg")).addComponent(cc.Sprite),this._debugUI.addChild(n),r=new cc.Node("scrollView").addComponent(cc.ScrollView),this._debugUI.addChild(r.node),r.node.width=r.node.parent.width,r.node.height=r.node.parent.height,r.horizontal=!1,r.vertical=!0,(s=new cc.Node("view")).addComponent(cc.Mask),r.node.addChild(s),s.width=s.parent.width,s.height=s.parent.height,c=new cc.Node("content"),s.addChild(c),r.content=c,c.width=s.width,(a=c.addComponent(cc.Layout)).type=cc.Layout.Type.VERTICAL,a.resizeMode=cc.Layout.ResizeMode.CONTAINER,h=new cc.Node("label"),this._debugLabel=h.addComponent(cc.RichText),c.addChild(h),this._debugLabel.node.color=cc.Color.BLACK,h.width=h.parent.width,this._debugLabel.fontSize=32,this._debugLabel.lineHeight=40,d=new cc.Node("clearButton"),this._debugUI.addChild(d),d.addComponent(cc.Button),d.addComponent(cc.Sprite),d.color=cc.Color.GREEN,d.on("click",e.clearLog,e),d.width=100,d.height=50,l=new cc.Node("clearLabel"),d.addChild(l),l.addComponent(cc.Label),l.getComponent(cc.Label).string="clear",[4,this.loadImages([t.WHITETEXTURE]).then((function(e){p._debugUI.width=i.width,p._debugUI.height=i.height;var t=p._debugUI.getChildByName("bg");t.getComponent(cc.Sprite).spriteFrame=e[0],t.getComponent(cc.Sprite).sizeMode=cc.Sprite.SizeMode.CUSTOM,t.width=t.parent.width,t.height=t.parent.height,r.node.width=r.node.parent.width,r.node.height=r.node.parent.height,s.width=s.parent.width,s.height=s.parent.height,c.width=c.parent.width-50,h.width=h.parent.width,p._debugLabel.maxWidth=h.width;var o=d.getComponent(cc.Sprite);o.spriteFrame=e[0],o.type=cc.Sprite.Type.SLICED,o.sizeMode=cc.Sprite.SizeMode.CUSTOM,d.width=180,d.height=60,d.color=cc.Color.GREEN,d.setPosition(i.width*(.5-i.anchorX),-i.anchorY*i.height+d.height/2)}))]);case 1:return o.sent(),this._debugUI.active=!1,[2]}}))}))},e.clearLog=function(){this._logString="",this._debugLabel.string=""},e.loadImages=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,Promise.all(e.map((function(e){return new Promise((function(t){var i=new window.Image;i.onload=function(){var e=new cc.Texture2D;e.initWithElement(i),e.handleLoadedTexture(),t(new cc.SpriteFrame(e))},i.src=e}))})))]}))}))},e.show=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._debugUI?[3,2]:[4,this.createUI()];case 1:e.sent(),e.label=2;case 2:return this._debugLabel.string=this._logString,this._debugUI.active=!0,[2]}}))}))},e.close=function(){this._debugUI.active=!1},e.isOpen=function(){return this._debugUI.active},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logString&&(this._logString+="\n"),this._logString+="<color=#000000>";for(var i=0;i<e.length;i++)if(Array.isArray(e[i]))for(var o=e[i],n=0;n<o.length;n++)this._logString+="string"==typeof o[n]?o[n]:JSON.stringify(o[n],this.replace),this._seen=[],this._logString+=" ";else this._logString+="string"==typeof e[i]?e[i]:JSON.stringify(e[i],this.replace),this._seen=[],this._logString+=" ";this._logString+="</color>"},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logString&&(this._logString+="\n"),this._logString+="<color=#ff0000>";for(var i=0;i<e.length;i++)if(Array.isArray(e[i]))for(var o=e[i],n=0;n<o.length;n++)this._logString+="string"==typeof o[n]?o[n]:JSON.stringify(o[n],this.replace),this._seen=[],this._logString+=" ";else this._logString+="string"==typeof e[i]?e[i]:JSON.stringify(e[i],this.replace),this._seen=[],this._logString+=" ";this._logString+="</color>"},e.replace=function(t,i){if(null!=i&&"object"==typeof i){if(e._seen.indexOf(i)>=0)return;e._seen.push(i)}return i},e._logString="",e._seen=[],e}();!function(e){e[e.MICMYOPEN=0]="MICMYOPEN",e[e.MICMYCLOSE=1]="MICMYCLOSE",e[e.MICOTHEROPEN=2]="MICOTHEROPEN",e[e.MICOTHERCLOSE=3]="MICOTHERCLOSE"}(c||(c={}));var d=function(){function n(){}return n.createUI=function(){return i(this,void 0,void 0,(function(){var e,i,r,s,a=this;return o(this,(function(o){switch(o.label){case 0:return n._microphoneUI?[2]:(e=cc.view.getVisibleSize(),n._scale=e.width/e.height>1125/2001?e.height/2001:e.width/1125,i=cc.director.getScene().getChildByName("Canvas"),this._microphoneUI=new cc.Node("microphoneUI"),this._microphoneUI.width=200,this._microphoneUI.height=64,cc.director.getScene().addChild(this._microphoneUI),this._microphoneUI.setSiblingIndex(Number.MAX_VALUE),this._microphoneUI.setPosition(i.width-this._microphoneUI.width/2,i.height-this._microphoneUI.height/2),cc.game.addPersistRootNode(this._microphoneUI),r=new cc.Node("myBtn"),this._microphoneUI.addChild(r),r.addComponent(cc.Button),r.setPosition(-50,-40),r.getComponent(cc.Button).transition=cc.Button.Transition.SCALE,r.getComponent(cc.Button).zoomScale=.8,r.getComponent(cc.Button).duration=.1,this._mySprite=r.addComponent(cc.Sprite),r.on("click",this.clickMyChat,this),s=new cc.Node("otherBtn"),this._microphoneUI.addChild(s),s.setPosition(50,-40),s.addComponent(cc.Button),s.getComponent(cc.Button).transition=cc.Button.Transition.SCALE,s.getComponent(cc.Button).zoomScale=.8,s.getComponent(cc.Button).duration=.1,this._otherSprite=s.addComponent(cc.Sprite),s.on("click",this.clickOtherChat,this),this._microphoneUI.active=!1,[4,this.loadImages([t.MICMYOPEN,t.MICMYCLOSE,t.MICOTHEROPEN,t.MICOTHERCLOSE]).then((function(e){a._spriteFrames=e,a._mySprite.spriteFrame=e[c.MICMYOPEN],a._otherSprite.spriteFrame=e[c.MICOTHEROPEN],a._mySprite.sizeMode=cc.Sprite.SizeMode.RAW,a._otherSprite.sizeMode=cc.Sprite.SizeMode.RAW,a._microphoneUI.setPosition(i.width-a._microphoneUI.width/2,i.height-a._microphoneUI.height/2)}))]);case 1:return o.sent(),[2]}}))}))},n.loadImages=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,Promise.all(e.map((function(e){return new Promise((function(t){var i=new window.Image;i.onload=function(){var e=new cc.Texture2D;e.initWithElement(i),e.handleLoadedTexture();var o=new cc.SpriteFrame(e),r=o.getOriginalSize();o.setOriginalSize(new cc.Size(r.width*n._scale,r.height*n._scale)),t(o)},i.src=e}))})))]}))}))},n.show=function(t){return i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:return this._microphoneUI?[3,2]:[4,this.createUI()];case 1:o.sent(),o.label=2;case 2:return[4,e.PVPMicrophone.init({openID:t.openID,roomNum:t.roomNum,appID:t.appID,source:t.source})];case 3:o.sent(),console.log("init success"),o.label=4;case 4:return o.trys.push([4,6,,7]),console.log("start chat"),[4,e.PVPMicrophone.startChat()];case 5:return o.sent(),[3,7];case 6:return i=o.sent(),console.error("start chat",i),[2];case 7:return console.log("startChat success"),this._isMyOpen=e.PVPMicrophone.getAudioStatus().local,this._isOtherOpen=e.PVPMicrophone.getAudioStatus().remote,this._microphoneUI.active=!0,this._mySprite.spriteFrame=this._isMyOpen?this._spriteFrames[c.MICMYOPEN]:this._spriteFrames[c.MICMYCLOSE],this._otherSprite.spriteFrame=this._isOtherOpen?this._spriteFrames[c.MICOTHEROPEN]:this._spriteFrames[c.MICOTHERCLOSE],[2]}}))}))},n.close=function(){this._microphoneUI&&(console.log("close cocos microphone ui"),this._microphoneUI.active=!1,e.PVPMicrophone.endChat())},n.clickMyChat=function(){var t=this;this._isMyOpen?e.PVPMicrophone.disableLocalAudio().then((function(){t._isMyOpen=!1,t._mySprite.spriteFrame=t._spriteFrames[c.MICMYCLOSE],console.log("disableLocalAudio success")})).catch((function(e){console.error("disableLocalAudio error",e)})):e.PVPMicrophone.enableLocalAudio().then((function(){t._isMyOpen=!0,t._mySprite.spriteFrame=t._spriteFrames[c.MICMYOPEN],console.log("enableLocalAudio success")})).catch((function(e){console.error("enableLocalAudio error",e)}))},n.clickOtherChat=function(){var t=this;this._isOtherOpen?e.PVPMicrophone.muteAllRemoteAudioStream().then((function(){t._isOtherOpen=!1,t._otherSprite.spriteFrame=t._spriteFrames[c.MICOTHERCLOSE],console.log("muteAllRemoteAudioStream success")})).catch((function(e){console.error("muteAllRemoteAudioStream error",e)})):e.PVPMicrophone.unmuteAllRemoteAudioStream().then((function(){t._isOtherOpen=!0,t._otherSprite.spriteFrame=t._spriteFrames[c.MICOTHEROPEN],console.log("unmuteAllRemoteAudioStream success")})).catch((function(e){console.error("unmuteAllRemoteAudioStream error",e)}))},n._isMyOpen=!1,n._isOtherOpen=!1,n._scale=1,n}();exports.DebugUI=h,exports.MicrophoneUI=d,exports.default=a;

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        