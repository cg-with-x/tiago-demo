(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/tiago/dist/tiago.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'tiago.cjs.production.min', __filename);"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("eventemitter3"),t=require("@byted-creative/pvp_match"),r=require("@byted-creative/cocos_pvp_ui"),o=e(r),i=require("@byted-creative/laya_pvp_ui"),s=e(require("@byted-creative/stt-promisify")),a=require("@byted-creative/pvp_microphone"),u=require("@byted-creative/pvp-client"),c=function(e,n){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function _(e,n){function t(){this.constructor=e}c(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}var I,h,l,p,A,f=function(){return(f=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function L(e,n,t,r){return new(t||(t=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}u((r=r.apply(e,n||[])).next())}))}function E(e,n){var t,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}!function(e){e.Test="test",e.Release="release"}(l||(l={})),function(e){e[e.Single=1]="Single",e[e.NVN=2]="NVN"}(p||(p={})),function(e){e.Wonderland="wonderland",e.LiveRoom="liveRoom"}(A||(A={}));var d,N,T=function(){return function(){var e=this;this.promise=new Promise((function(n,t){Object.defineProperties(e,{resolve:{value:function(t){e.value=t,n(t)},writable:!1},reject:{value:t,writable:!1}})}))}}();!function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE",e[e.GEN_CHANNEL_ERROR=101]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=102]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=103]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=104]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=105]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=106]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=107]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=108]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=109]="UNMUTE_ALL_REMOTE_AUDIO_FAIL",e[e.GAME_ROOM_CONNECTION_LOST=201]="GAME_ROOM_CONNECTION_LOST",e[e.WITHOUT_INIT=301]="WITHOUT_INIT",e[e.INVALID_INPUT=302]="INVALID_INPUT"}(d||(d={})),function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE"}(N||(N={}));var O,C,m=((I={})[N.MATCH_SUCCESS]="success",I[N.MATCH_ERROR]="match error",I[N.MATCH_TIMEOUT]="match timeout",I[N.MATCH_CANCEL]="match cancel",I[N.MATCH_CLOSE]="match interrupted by other reasons",I);!function(e){e[e.GEN_CHANNEL_ERROR=1]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=2]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=3]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=4]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=5]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=6]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=7]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=8]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=9]="UNMUTE_ALL_REMOTE_AUDIO_FAIL"}(O||(O={})),(h={})[O.GEN_CHANNEL_ERROR]="生成连麦频道id失败",h[O.GET_AUTH_FAILED]="获取权限失败",h[O.JOIN_CHANNEL_FAIL]="加入连麦频道失败",h[O.CONNECTION_LOST]="连麦频道链接丢失",h[O.LEAVE_CHANNEL_FAIL]="离开连麦频道失败",h[O.ENABLE_LOCAL_AUDIO_FAIL]="开启本地推流失败",h[O.DISABLE_LOCAL_AUDIO_FAIL]="关闭本地推流失败",h[O.MUTE_ALL_REMOTE_AUDIO_FAIL]="远端静音失败",h[O.UNMUTE_ALL_REMOTE_AUDIO_FAIL]="解除远端静音失败",function(e){e[e.CONNECTION_LOST=201]="CONNECTION_LOST"}(C||(C={}));var v=function(e){function n(n,t){var r=e.call(this,t)||this;return r.code=n,r.msg=t,r}return _(n,e),n}(Error),g=function(e){function n(n){var r=e.call(this)||this;return n&&n.debugInstance&&(r._debugInstance=n.debugInstance,t.PVPMatch.setDebugLog(r._debugInstance)),r._config=n,r}return _(n,e),n.prototype.startMatch=function(){return L(this,void 0,void 0,(function(){var e,n,r,o=this;return E(this,(function(i){switch(i.label){case 0:return n=(e=this._config).launchScene||e.launch_scene,r=this.getMatchUI(),e.userInfo.isAnchor="streamer"===e.playerRole,this.log("input match init data",{gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),t.PVPMatch.init({gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),r?[4,r.show(e.playerNumber,e.userInfo,this._config.debug)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.log("init info",e),e&&"liveStream"===n&&(this.log("live sdk setPreferredFramesPerSecond 30"),s.setPreferredFramesPerSecond(30)),t.PVPMatch.startMatch(this._config.retryCount).then((function(e){return L(o,void 0,void 0,(function(){var n,t,o,i,s,a;return E(this,(function(u){switch(u.label){case 0:for(this.log("match success data",e),n=e.roomNum,t=e.playerList,o=[],i=[],s=0;s<t.length;s++)(a={size:1,playerList:[]}).playerList.push(t[s].extraInfo),o.push(a),i.push(t[s].extraInfo);return r?(r.matchSuccess(t),[4,r.whenClosed()]):[3,2];case 1:u.sent(),u.label=2;case 2:return this.emit("match-success",{id:this._config.appId+"-"+n+"-"+(new Date).getTime(),type:p.Single,teamList:o,playerList:i}),this.emit("create-game-room-success",{roomNum:n}),[2]}}))}))})).catch((function(e){o.emit("error",{code:e.reason,msg:m[e.reason]})})),[2]}}))}))},n.prototype.onMatchSuccess=function(e){this.on("match-success",e)},n.prototype.onCreateGameRoomSuccess=function(e){this.on("create-game-room-success",e)},n.prototype.onError=function(e){this.on("error",e)},n.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log&&this._debugInstance.log(e)},n.prototype.getMatchUI=function(){return"undefined"!=typeof cc?o.instance:"undefined"!=typeof Laya?i.MatchUILaya.instance:null},n}(n.EventEmitter),y={__proto__:null,isTT:function(){return"undefined"!=typeof tt}};exports.default=function(){function e(){}return e.init=function(n){return L(this,void 0,void 0,(function(){var t,r,o,i,s,u;return E(this,(function(c){return t=new T,this._instance||(this._instance=new e),r=this.getDebugUI(),n.debug&&r&&(this._debugInstance=r,a.PVPMicrophone.setDebugLog(r)),this._query=tt.getLaunchOptionsSync().query,o="",i=this._query.newComer,s=this._query.aiInfo||{},this._config="liveStream"===this._query.launchScene?{currentScene:o="liveRoom",scene:{liveRoom:{isNewComer:i,isAIRequired:!1,aiInfo:i?{openId:s.openId||s.open_id,nickName:s.nickName,avatarUrl:s.avatarUrl,gender:s.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!0}:void 0}}}:"wonderland"===this._query.launchScene?{currentScene:o="wonderland",scene:{wonderland:{isNewComer:this._query.newcomer,aiInfo:i?{openId:s.openId||s.open_id,nickName:s.nickName,avatarUrl:s.avatarUrl,gender:s.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!1}:void 0}}}:{currentScene:o="",scene:{}},this._userInfo={openId:(u=this._query.userInfo||{}).openId||u.open_id,nickName:u.nickName,avatarUrl:u.avatarUrl,gender:u.gender,city:"",province:"",country:"",language:"",isLiveStreaming:"liveRoom"===o},this._options=n,this._hasInit=!0,t.resolve(),[2,t.promise]}))}))},e.getConfig=function(){if(!this._hasInit)throw new v(d.WITHOUT_INIT,"please invoke init() before!");return this._config},e.getUserInfo=function(){if(!this._hasInit)throw new v(d.WITHOUT_INIT,"please invoke init() before!");return this._userInfo},e.startSingleMatch=function(e){if(void 0===e&&(e={retryCount:3}),!this._hasInit)throw new v(d.WITHOUT_INIT,"please invoke init() before!");var n=new g({appID:this._options.appId,environment:"online"===this._query.environment?"online":"test",playerRole:this._userInfo.isLiveStreaming?"streamer":"unknown",hostAppId:this._query.hostAppId,gameId:this._options.appId||this._query.gameId,playerNumber:2,launchScene:this._query.launchScene,isMultiPlayer:!1,userInfo:this._userInfo,debugInstance:this._debugInstance,debug:this._options.debug||!1,retryCount:e.retryCount});return n.startMatch(),n},e.joinGameRoom=function(e){if(!this._hasInit)throw new v(d.WITHOUT_INIT,"please invoke init() before!");return this._roomNum=e.roomNum,u.PVPClient.initConfig({appId:this._options.appId,environment:"online"===this._query.environment?"online":"test",aId:this._query.hostAppId,platformId:"wonderland",extraInfo:f(f({},this._userInfo),{openid:this._userInfo.openId,open_id:this._userInfo.openId,businessID:"2",name:this._userInfo.nickName,icon:this._userInfo.avatarUrl})}),u.PVPClient.joinGameRoom({roomNum:e.roomNum})},e.joinRTCForGameRoom=function(e){return L(this,void 0,void 0,(function(){var n,t;return E(this,(function(r){if(!this._hasInit)throw new v(d.WITHOUT_INIT,"please invoke init() before!");if(n=new T,e||n.reject(new v(d.INVALID_INPUT,"invalid input")),t=this.getMicrophoneUI()){this.log("input open micro data",{openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"});try{t.show({openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"})}catch(e){this.log("open micro error",e)}}return n.resolve(),[2,n.promise]}))}))},e.getMicrophoneUI=function(){return"undefined"!=typeof cc?r.MicrophoneUI:"undefined"!=typeof Laya?i.MicrophoneUILaya.instance:null},e.getDebugUI=function(){return"undefined"!=typeof cc?r.DebugUI:"undefined"!=typeof Laya?i.DebugUI.instance:null},e.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log(e)},e.GAME_ENV=l,e.MATCH_TYPE=p,e.BUSINESS_SCENE=A,e.utils=y,e._hasInit=!1,e}();

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        