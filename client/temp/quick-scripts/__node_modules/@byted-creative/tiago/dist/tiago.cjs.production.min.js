(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/tiago/dist/tiago.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'tiago.cjs.production.min', __filename);"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n,t,i,r,o,a=require("eventemitter3"),s=require("@byted-creative/pvp_match"),u=require("@byted-creative/cocos_pvp_ui"),c=e(u),_=require("@byted-creative/laya_pvp_ui"),I=e(require("@byted-creative/stt-promisify")),h=require("@byted-creative/pvp_microphone"),l=require("@byted-creative/pvp-client"),p=function(e,n){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function A(e,n){function t(){this.constructor=e}p(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}function f(e,n,t,i){return new(t||(t=Promise))((function(r,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}u((i=i.apply(e,n||[])).next())}))}function L(e,n){var t,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(e,a)}catch(e){o=[6,e],i=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}!function(e){e.Test="test",e.Release="release"}(i||(i={})),function(e){e[e.Single=1]="Single",e[e.NVN=2]="NVN"}(r||(r={})),function(e){e.Wonderland="wonderland",e.LiveRoom="liveRoom"}(o||(o={}));var E,d,N=function(){return function(){var e=this;this.promise=new Promise((function(n,t){Object.defineProperties(e,{resolve:{value:function(t){e.value=t,n(t)},writable:!1},reject:{value:t,writable:!1}})}))}}();!function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE",e[e.GEN_CHANNEL_ERROR=101]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=102]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=103]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=104]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=105]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=106]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=107]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=108]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=109]="UNMUTE_ALL_REMOTE_AUDIO_FAIL",e[e.GAME_ROOM_CONNECTION_LOST=201]="GAME_ROOM_CONNECTION_LOST",e[e.WITHOUT_INIT=301]="WITHOUT_INIT",e[e.INVALID_INPUT=302]="INVALID_INPUT"}(E||(E={})),function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE"}(d||(d={}));var T,m,C=((n={})[d.MATCH_SUCCESS]="success",n[d.MATCH_ERROR]="match error",n[d.MATCH_TIMEOUT]="match timeout",n[d.MATCH_CANCEL]="match cancel",n[d.MATCH_CLOSE]="match interrupted by other reasons",n);!function(e){e[e.GEN_CHANNEL_ERROR=1]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=2]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=3]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=4]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=5]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=6]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=7]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=8]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=9]="UNMUTE_ALL_REMOTE_AUDIO_FAIL"}(T||(T={})),(t={})[T.GEN_CHANNEL_ERROR]="生成连麦频道id失败",t[T.GET_AUTH_FAILED]="获取权限失败",t[T.JOIN_CHANNEL_FAIL]="加入连麦频道失败",t[T.CONNECTION_LOST]="连麦频道链接丢失",t[T.LEAVE_CHANNEL_FAIL]="离开连麦频道失败",t[T.ENABLE_LOCAL_AUDIO_FAIL]="开启本地推流失败",t[T.DISABLE_LOCAL_AUDIO_FAIL]="关闭本地推流失败",t[T.MUTE_ALL_REMOTE_AUDIO_FAIL]="远端静音失败",t[T.UNMUTE_ALL_REMOTE_AUDIO_FAIL]="解除远端静音失败",function(e){e[e.CONNECTION_LOST=201]="CONNECTION_LOST"}(m||(m={}));var O=function(e){function n(n,t){var i=e.call(this,t)||this;return i.code=n,i.msg=t,i}return A(n,e),n}(Error),g=function(e){function n(n){var t=e.call(this)||this;return n&&n.debugInstance&&(t._debugInstance=n.debugInstance,s.PVPMatch.setDebugLog(t._debugInstance)),t._config=n,t}return A(n,e),n.prototype.startMatch=function(){return f(this,void 0,void 0,(function(){var e,n,t,i=this;return L(this,(function(r){switch(r.label){case 0:return n=(e=this._config).launchScene||e.launch_scene,t=this.getMatchUI(),e.userInfo.isAnchor="streamer"===e.playerRole,this.log("input match init data",{gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),s.PVPMatch.init({gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),t?[4,t.show(e.playerNumber,e.userInfo,this._config.debug)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.log("init info",e),e&&"liveStream"===n&&(this.log("live sdk setPreferredFramesPerSecond 30"),I.setPreferredFramesPerSecond(30)),s.PVPMatch.startMatch(this._config.retryCount).catch((function(e){I.showToast({title:"暂时没有对手，换个游戏玩吧",icon:"none",duration:3e3}),i.emit("error",{code:e.reason,msg:C[e.reason]})})).then((function(e){return f(i,void 0,void 0,(function(){var n,i,r,o,a,s,u,c;return L(this,(function(_){switch(_.label){case 0:if(!e)return[2];for(this.log("match success data",e),n=e.roomNum,i=e.playerList,r=[],o=[],a=0;a<i.length;a++)(s={size:1,playerList:[]}).playerList.push(c={openId:(u=i[a].extraInfo).openId,nickName:u.nickName,avatarUrl:u.avatarUrl,gender:u.gender,city:u.city,province:u.province,country:u.country,language:u.language,isLiveStreaming:u.isLiveStreaming}),r.push(s),o.push(c);return t?(t.matchSuccess(i),[4,t.whenClosed()]):[3,2];case 1:_.sent(),_.label=2;case 2:return this.emit("match-success",{id:this._config.appID+"-"+n+"-"+(new Date).getTime(),type:this._config.matchType,teamList:r,playerList:o}),this.emit("create-game-room-success",{roomNum:n}),[2]}}))}))})),[2]}}))}))},n.prototype.onMatchSuccess=function(e){this.on("match-success",e)},n.prototype.onCreateGameRoomSuccess=function(e){this.on("create-game-room-success",e)},n.prototype.onError=function(e){this.on("error",e)},n.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log&&this._debugInstance.log(e)},n.prototype.getMatchUI=function(){return"undefined"!=typeof cc?c.instance:"undefined"!=typeof Laya?_.MatchUILaya.instance:null},n}(a.EventEmitter),v={__proto__:null,isTT:function(){return"undefined"!=typeof tt}};exports.default=function(){function e(){}return e.init=function(n){return f(this,void 0,void 0,(function(){var t,i,r,o,a,s;return L(this,(function(u){return t=new N,this._instance||(this._instance=new e),i=this.getDebugUI(),n.debug&&i&&(this._debugInstance=i,h.PVPMicrophone.setDebugLog(i)),this._query=tt.getLaunchOptionsSync().query,r="",o=this._query.newComer,a=this._query.aiInfo||{},this._config="liveStream"===this._query.launchScene?{currentScene:r="liveRoom",scene:{liveRoom:{isNewComer:o,isAIRequired:!1,aiInfo:o?{openId:a.openId||a.open_id,nickName:a.nickName,avatarUrl:a.avatarUrl,gender:a.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!0}:void 0}}}:"wonderland"===this._query.launchScene?{currentScene:r="wonderland",scene:{wonderland:{isNewComer:this._query.newcomer,aiInfo:o?{openId:a.openId||a.open_id,nickName:a.nickName,avatarUrl:a.avatarUrl,gender:a.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!1}:void 0}}}:{currentScene:r="",scene:{}},this._userInfo={openId:(s=this._query.userInfo||{}).openId||s.open_id,nickName:s.nickName,avatarUrl:s.avatarUrl,gender:s.gender,city:"",province:"",country:"",language:"",isLiveStreaming:"liveRoom"===r},this._options=n,this._hasInit=!0,t.resolve(),[2,t.promise]}))}))},e.getConfig=function(){if(!this._hasInit)throw new O(E.WITHOUT_INIT,"please invoke init() before!");return this._config},e.getUserInfo=function(){if(!this._hasInit)throw new O(E.WITHOUT_INIT,"please invoke init() before!");return this._userInfo},e.startSingleMatch=function(e){if(void 0===e&&(e={retryCount:3}),!this._hasInit)throw new O(E.WITHOUT_INIT,"please invoke init() before!");var n=new g({appID:this._options.appId,environment:"online"===this._query.environment?"online":"test",playerRole:this._userInfo.isLiveStreaming?"streamer":"unknown",hostAppId:this._query.hostAppId,gameId:this._options.appId||this._query.gameId,playerNumber:2,launchScene:this._query.launchScene,isMultiPlayer:!1,userInfo:this._userInfo,debugInstance:this._debugInstance,debug:this._options.debug||!1,retryCount:e.retryCount,matchType:this.MATCH_TYPE.NVN});return n.startMatch(),n},e.joinGameRoom=function(e){if(!this._hasInit)throw new O(E.WITHOUT_INIT,"please invoke init() before!");return this._roomNum=e.roomNum,l.PVPClient.initConfig({appId:this._options.appId,environment:"online"===this._query.environment?"online":"test",aId:this._query.hostAppId,platformId:"wonderland",extraInfo:this._userInfo}),l.PVPClient.joinGameRoom({roomNum:e.roomNum})},e.joinRTCForGameRoom=function(e){return f(this,void 0,void 0,(function(){var n,t;return L(this,(function(i){if(!this._hasInit)throw new O(E.WITHOUT_INIT,"please invoke init() before!");if(n=new N,e||n.reject(new O(E.INVALID_INPUT,"invalid input")),t=this.getMicrophoneUI()){this.log("input open micro data",{openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"});try{t.show({openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"})}catch(e){this.log("open micro error",e)}}return n.resolve(),[2,n.promise]}))}))},e.getMicrophoneUI=function(){return"undefined"!=typeof cc?u.MicrophoneUI:"undefined"!=typeof Laya?_.MicrophoneUILaya.instance:null},e.getDebugUI=function(){return"undefined"!=typeof cc?u.DebugUI:"undefined"!=typeof Laya?_.DebugUI.instance:null},e.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log(e)},e.GAME_ENV=i,e.MATCH_TYPE=r,e.BUSINESS_SCENE=o,e.utils=v,e._hasInit=!1,e}();

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        