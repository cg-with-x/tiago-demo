(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/tiago/dist/tiago.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'tiago.cjs.production.min', __filename);"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("eventemitter3"),n=require("@byted-creative/pvp_match"),r=require("@byted-creative/cocos_pvp_ui"),i=e(r),o=require("@byted-creative/laya_pvp_ui"),a=e(require("@byted-creative/stt-promisify")),s=require("@byted-creative/pvp_microphone"),c=require("@byted-creative/pvp-client"),u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function _(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var I,h,l,p,f,A=function(){return(A=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function L(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function E(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}!function(e){e.Test="test",e.Release="release"}(l||(l={})),function(e){e[e.Single=1]="Single",e[e.NVN=2]="NVN"}(p||(p={})),function(e){e.Wonderland="wonderland",e.LiveRoom="liveRoom"}(f||(f={}));var d,N,T=function(){return function(){var e=this;this.promise=new Promise((function(t,n){Object.defineProperties(e,{resolve:{value:function(n){e.value=n,t(n)},writable:!1},reject:{value:n,writable:!1}})}))}}();!function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE",e[e.GEN_CHANNEL_ERROR=101]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=102]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=103]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=104]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=105]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=106]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=107]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=108]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=109]="UNMUTE_ALL_REMOTE_AUDIO_FAIL",e[e.GAME_ROOM_CONNECTION_LOST=201]="GAME_ROOM_CONNECTION_LOST",e[e.WITHOUT_INIT=301]="WITHOUT_INIT",e[e.INVALID_INPUT=302]="INVALID_INPUT"}(d||(d={})),function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE"}(N||(N={}));var O,m,C=((I={})[N.MATCH_SUCCESS]="success",I[N.MATCH_ERROR]="match error",I[N.MATCH_TIMEOUT]="match timeout",I[N.MATCH_CANCEL]="match cancel",I[N.MATCH_CLOSE]="match interrupted by other reasons",I);!function(e){e[e.GEN_CHANNEL_ERROR=1]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=2]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=3]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=4]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=5]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=6]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=7]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=8]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=9]="UNMUTE_ALL_REMOTE_AUDIO_FAIL"}(O||(O={})),(h={})[O.GEN_CHANNEL_ERROR]="生成连麦频道id失败",h[O.GET_AUTH_FAILED]="获取权限失败",h[O.JOIN_CHANNEL_FAIL]="加入连麦频道失败",h[O.CONNECTION_LOST]="连麦频道链接丢失",h[O.LEAVE_CHANNEL_FAIL]="离开连麦频道失败",h[O.ENABLE_LOCAL_AUDIO_FAIL]="开启本地推流失败",h[O.DISABLE_LOCAL_AUDIO_FAIL]="关闭本地推流失败",h[O.MUTE_ALL_REMOTE_AUDIO_FAIL]="远端静音失败",h[O.UNMUTE_ALL_REMOTE_AUDIO_FAIL]="解除远端静音失败",function(e){e[e.CONNECTION_LOST=201]="CONNECTION_LOST"}(m||(m={}));var g=function(e){function t(t,n){var r=e.call(this,n)||this;return r.code=t,r.msg=n,r}return _(t,e),t}(Error),v=function(e){function t(t){var r=e.call(this)||this;return t&&t.debugInstance&&(r._debugInstance=t.debugInstance,n.PVPMatch.setDebugLog(r._debugInstance)),r._config=t,r}return _(t,e),t.prototype.startMatch=function(){return L(this,void 0,void 0,(function(){var e,t,r,i=this;return E(this,(function(o){switch(o.label){case 0:return t=(e=this._config).launchScene||e.launch_scene,r=this.getMatchUI(),e.userInfo.isAnchor="streamer"===e.playerRole,this.log("input match init data",{gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),n.PVPMatch.init({gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),r?[4,r.show(e.playerNumber,e.userInfo,this._config.debug)]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.log("init info",e),e&&"liveStream"===t&&(this.log("live sdk setPreferredFramesPerSecond 30"),a.setPreferredFramesPerSecond(30)),n.PVPMatch.startMatch(this._config.retryCount).catch((function(e){a.showToast({title:"暂时没有对手，换个游戏玩吧",icon:"none",duration:3e3}),i.emit("error",{code:e.reason,msg:C[e.reason]})})).then((function(e){return L(i,void 0,void 0,(function(){var t,n,i,o,a,s,c,u;return E(this,(function(_){switch(_.label){case 0:if(!e)return[2];for(this.log("match success data",e),t=e.roomNum,n=e.playerList,i=[],o=[],a=0;a<n.length;a++)(s={size:1,playerList:[]}).playerList.push(A({},u={openId:(c=n[a].extraInfo).openId,nickName:c.nickName,avatarUrl:c.avatarUrl,gender:c.gender,city:c.city,province:c.province,country:c.country,language:c.language,isLiveStreaming:c.isLiveStreaming})),i.push(s),o.push(A({},u));return r?(r.matchSuccess(n),[4,r.whenClosed()]):[3,2];case 1:_.sent(),_.label=2;case 2:return this.emit("match-success",{id:this._config.appID+"-"+t+"-"+(new Date).getTime(),type:this._config.matchType,teamList:i,playerList:o}),this.emit("create-game-room-success",{roomNum:t}),[2]}}))}))})),[2]}}))}))},t.prototype.onMatchSuccess=function(e){this.on("match-success",e)},t.prototype.onCreateGameRoomSuccess=function(e){this.on("create-game-room-success",e)},t.prototype.onError=function(e){this.on("error",e)},t.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._debugInstance&&this._debugInstance.log&&this._debugInstance.log(e)},t.prototype.getMatchUI=function(){return"undefined"!=typeof cc?i.instance:"undefined"!=typeof Laya?o.MatchUILaya.instance:null},t}(t.EventEmitter),y={__proto__:null,isTT:function(){return"undefined"!=typeof tt}};exports.default=function(){function e(){}return e.init=function(t){return L(this,void 0,void 0,(function(){var n,r,i,o,a,c;return E(this,(function(u){return n=new T,this._instance||(this._instance=new e),r=this.getDebugUI(),t.debug&&r&&(this._debugInstance=r,s.PVPMicrophone.setDebugLog(r)),this._query=tt.getLaunchOptionsSync().query,i="",o=this._query.newComer,a=this._query.aiInfo||{},this._config="liveStream"===this._query.launchScene?{currentScene:i="liveRoom",scene:{liveRoom:{isNewComer:o,isAIRequired:!1,aiInfo:o?{openId:a.openId||a.open_id,nickName:a.nickName,avatarUrl:a.avatarUrl,gender:a.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!0}:void 0}}}:"wonderland"===this._query.launchScene?{currentScene:i="wonderland",scene:{wonderland:{isNewComer:this._query.newcomer,aiInfo:o?{openId:a.openId||a.open_id,nickName:a.nickName,avatarUrl:a.avatarUrl,gender:a.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!1}:void 0}}}:{currentScene:i="",scene:{}},this._userInfo={openId:(c=this._query.userInfo||{}).openId||c.open_id,nickName:c.nickName,avatarUrl:c.avatarUrl,gender:c.gender,city:"",province:"",country:"",language:"",isLiveStreaming:"liveRoom"===i},this._options=t,this._hasInit=!0,n.resolve(),[2,n.promise]}))}))},e.getMatchUI=function(){return"undefined"!=typeof cc?i.instance:"undefined"!=typeof Laya?o.MatchUILaya.instance:null},e.getConfig=function(){if(!this._hasInit)throw new g(d.WITHOUT_INIT,"please invoke init() before!");return this._config},e.getUserInfo=function(){if(!this._hasInit)throw new g(d.WITHOUT_INIT,"please invoke init() before!");return this._userInfo},e.closeMatchUI=function(){var e=this.getMatchUI();e&&e.close()},e.startSingleMatch=function(e){if(void 0===e&&(e={retryCount:3}),!this._hasInit)throw new g(d.WITHOUT_INIT,"please invoke init() before!");var t=this.getMicrophoneUI();t&&t.close();var n=new v({appID:this._options.appId,environment:"online"===this._query.environment?"online":"test",playerRole:this._userInfo.isLiveStreaming?"streamer":"unknown",hostAppId:this._query.hostAppId,gameId:this._options.appId||this._query.gameId,playerNumber:2,launchScene:this._query.launchScene,isMultiPlayer:!1,userInfo:this._userInfo,debugInstance:this._debugInstance,debug:this._options.debug||!1,retryCount:e.retryCount,matchType:this.MATCH_TYPE.NVN});return n.startMatch(),n},e.joinGameRoom=function(e){if(!this._hasInit)throw new g(d.WITHOUT_INIT,"please invoke init() before!");return this._roomNum=e.roomNum,c.PVPClient.initConfig({appId:this._options.appId,environment:"online"===this._query.environment?"online":"test",aId:this._query.hostAppId,platformId:"wonderland",extraInfo:this._userInfo}),c.PVPClient.joinGameRoom({roomNum:e.roomNum})},e.joinRTCForGameRoom=function(e){return L(this,void 0,void 0,(function(){var t,n;return E(this,(function(r){if(!this._hasInit)throw new g(d.WITHOUT_INIT,"please invoke init() before!");if(t=new T,e||t.reject(new g(d.INVALID_INPUT,"invalid input")),n=this.getMicrophoneUI()){this.log("input open micro data",{openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"});try{n.show({openID:this._userInfo.openId,roomNum:this._roomNum,appID:this._options.appId,source:"live"})}catch(e){this.log("open micro error",e)}}return t.resolve(),[2,t.promise]}))}))},e.getMicrophoneUI=function(){return"undefined"!=typeof cc?r.MicrophoneUI:"undefined"!=typeof Laya?o.MicrophoneUILaya.instance:null},e.getDebugUI=function(){return"undefined"!=typeof cc?r.DebugUI:"undefined"!=typeof Laya?o.DebugUI.instance:null},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._debugInstance&&this._debugInstance.log(e)},e.GAME_ENV=l,e.MATCH_TYPE=p,e.BUSINESS_SCENE=f,e.utils=y,e._hasInit=!1,e}();

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        