(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/tiago/dist/tiago.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'tiago.cjs.production.min', __filename);"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var n=require("eventemitter3"),t=require("@byted-creative/pvp_match"),o=require("@byted-creative/cocos_pvp_ui"),r=e(o),i=require("@byted-creative/laya_pvp_ui"),s=e(require("@byted-creative/stt-promisify")),a=require("@byted-creative/pvp_microphone"),u=require("@byted-creative/pvp-client"),c=function(e,n){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function _(e,n){function t(){this.constructor=e}c(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}var I,h,l,p,f,A=function(){return(A=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function d(e,n,t,o){return new(t||(t=Promise))((function(r,i){function s(e){try{u(o.next(e))}catch(e){i(e)}}function a(e){try{u(o.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}u((o=o.apply(e,n||[])).next())}))}function m(e,n){var t,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],o=0}finally{t=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}!function(e){e.Test="test",e.Release="release"}(l||(l={})),function(e){e[e.Single=1]="Single",e[e.NVN=2]="NVN"}(p||(p={})),function(e){e.Wonderland="wonderland",e.LiveRoom="liveRoom"}(f||(f={}));var L,E,N=function(){return function(){var e=this;this.promise=new Promise((function(n,t){Object.defineProperties(e,{resolve:{value:function(t){e.value=t,n(t)},writable:!1},reject:{value:t,writable:!1}})}))}}();!function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE",e[e.GEN_CHANNEL_ERROR=101]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=102]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=103]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=104]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=105]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=106]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=107]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=108]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=109]="UNMUTE_ALL_REMOTE_AUDIO_FAIL",e[e.GAME_ROOM_CONNECTION_LOST=201]="GAME_ROOM_CONNECTION_LOST",e[e.WITHOUT_INIT=301]="WITHOUT_INIT"}(L||(L={})),function(e){e[e.MATCH_SUCCESS=0]="MATCH_SUCCESS",e[e.MATCH_ERROR=1]="MATCH_ERROR",e[e.MATCH_TIMEOUT=2]="MATCH_TIMEOUT",e[e.MATCH_CANCEL=3]="MATCH_CANCEL",e[e.MATCH_CLOSE=4]="MATCH_CLOSE"}(E||(E={}));var O,T,g=((I={})[E.MATCH_SUCCESS]="success",I[E.MATCH_ERROR]="match error",I[E.MATCH_TIMEOUT]="match timeout",I[E.MATCH_CANCEL]="match cancel",I[E.MATCH_CLOSE]="match interrupted by other reasons",I);!function(e){e[e.GEN_CHANNEL_ERROR=1]="GEN_CHANNEL_ERROR",e[e.GET_AUTH_FAILED=2]="GET_AUTH_FAILED",e[e.JOIN_CHANNEL_FAIL=3]="JOIN_CHANNEL_FAIL",e[e.CONNECTION_LOST=4]="CONNECTION_LOST",e[e.LEAVE_CHANNEL_FAIL=5]="LEAVE_CHANNEL_FAIL",e[e.ENABLE_LOCAL_AUDIO_FAIL=6]="ENABLE_LOCAL_AUDIO_FAIL",e[e.DISABLE_LOCAL_AUDIO_FAIL=7]="DISABLE_LOCAL_AUDIO_FAIL",e[e.MUTE_ALL_REMOTE_AUDIO_FAIL=8]="MUTE_ALL_REMOTE_AUDIO_FAIL",e[e.UNMUTE_ALL_REMOTE_AUDIO_FAIL=9]="UNMUTE_ALL_REMOTE_AUDIO_FAIL"}(O||(O={})),(h={})[O.GEN_CHANNEL_ERROR]="生成连麦频道id失败",h[O.GET_AUTH_FAILED]="获取权限失败",h[O.JOIN_CHANNEL_FAIL]="加入连麦频道失败",h[O.CONNECTION_LOST]="连麦频道链接丢失",h[O.LEAVE_CHANNEL_FAIL]="离开连麦频道失败",h[O.ENABLE_LOCAL_AUDIO_FAIL]="开启本地推流失败",h[O.DISABLE_LOCAL_AUDIO_FAIL]="关闭本地推流失败",h[O.MUTE_ALL_REMOTE_AUDIO_FAIL]="远端静音失败",h[O.UNMUTE_ALL_REMOTE_AUDIO_FAIL]="解除远端静音失败",function(e){e[e.CONNECTION_LOST=201]="CONNECTION_LOST"}(T||(T={}));var v=function(e){function n(n,t){var o=e.call(this,t)||this;return o.code=n,o.msg=t,o}return _(n,e),n}(Error),C=function(e){function n(n){var o=e.call(this)||this;return n&&n.debugInstance&&(o._debugInstance=n.debugInstance,t.PVPMatch.setDebugLog(o._debugInstance)),o._config=n,o}return _(n,e),n.prototype.startMatch=function(){return d(this,void 0,void 0,(function(){var e,n,o,r=this;return m(this,(function(i){switch(i.label){case 0:return n=(e=this._config).launchScene||e.launch_scene,o=this.getMatchUI(),e.userInfo.isAnchor="streamer"===e.playerRole,this.log("input match init data",{gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),t.PVPMatch.init({gameId:e.gameId,environment:e.environment,hostAppId:e.hostAppId,userInfo:e.userInfo,isMultiPlayer:e.isMultiPlayer}),o?[4,o.show(e.playerNumber,e.userInfo,this._config.debug)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.log("init info",e),e&&"liveStream"===n&&(this.log("live sdk setPreferredFramesPerSecond 30"),s.setPreferredFramesPerSecond(30)),t.PVPMatch.startMatch(this._config.retryCount).then((function(e){return d(r,void 0,void 0,(function(){var n,t,r,i,s,a;return m(this,(function(u){switch(u.label){case 0:for(this.log("match success data",e),n=e.roomNum,t=e.playerList,r=[],i=[],s=0;s<t.length;s++)(a={size:1,playerList:[]}).playerList.push(t[s].extraInfo),r.push(a),i.push(t[s].extraInfo);return o?(o.matchSuccess(t),[4,o.whenClosed()]):[3,2];case 1:u.sent(),u.label=2;case 2:return this.emit("success",{id:this._config.appId+"-"+n+"-"+(new Date).getTime(),type:p.Single,teamList:r,playerList:i}),this.emit("createGameRoom",{roomNum:n}),[2]}}))}))})).catch((function(e){r.emit("error",{code:e.reason,msg:g[e.reason]})})),[2]}}))}))},n.prototype.onMatchSuccess=function(e){this.on("success",e)},n.prototype.onCreateGameRoomSuccess=function(e){this.on("createGameRoom",e)},n.prototype.onError=function(e){this.on("error",e)},n.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log&&this._debugInstance.log(e)},n.prototype.getMatchUI=function(){return"undefined"!=typeof cc?r.instance:"undefined"!=typeof Laya?i.MatchUILaya.instance:null},n}(n.EventEmitter),y=function(e){function n(n){var t=e.call(this)||this;t.log("init game room",n.roomNum,n.userInfo),t.roomNum=n.roomNum;var o=n.userInfo;return t._debugInstance=n.debugInstance,u.PVPClient.initConfig({appId:n.gameId,aId:n.hostAppId,environment:"online"===n.environment?"online":"test",platformId:"wonderland",extraInfo:A(A({},o),{openid:o.openId,open_id:o.openId,businessID:"2",name:o.nickName,icon:o.avatarUrl})}),t.joinGameRoom(),t}return _(n,e),n.prototype.joinGameRoom=function(){var e=this,n=u.PVPClient.joinGameRoom({roomNum:this.roomNum});this._room=n;var t=null;t&&clearTimeout(t),n.on("open",(function(){e.emit("open")})),n.on("message",(function(n){e.emit("message",n)})),n.on("close",(function(){e.emit("error",{code:L.GAME_ROOM_CONNECTION_LOST,msg:"connection to room closed"})})),n.on("error",(function(n){e.emit("error",{code:n.code,msg:n.errMsg||n.message||""})})),this.on("error",(function(n){e.log("room error",n),e.removeAllListeners(),t&&clearTimeout(t),t=setTimeout((function(){e.joinGameRoom()}),3e3)}))},n.prototype.send=function(e){this.log("room send",e),this._room&&this._room.send(e)},n.prototype.onMessage=function(e){this.on("message",e)},n.prototype.leave=function(){this._room&&(this.removeAllListeners(),this._room.close())},n.prototype.onError=function(e){this.on("error",e)},n.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log(e)},n}(n.EventEmitter),M={__proto__:null,isTT:function(){return"undefined"!=typeof tt}};exports.default=function(){function e(){}return e.init=function(n){return d(this,void 0,void 0,(function(){var t,o,r,i,s,u;return m(this,(function(c){return t=new N,this._instance||(this._instance=new e),o=this.getDebugUI(),n.debug&&o&&(this._debugInstance=o,a.PVPMicrophone.setDebugLog(o)),this._query=tt.getLaunchOptionsSync().query,r="",i=this._query.newComer,s=this._query.aiInfo||{},this._config="liveStream"===this._query.launchScene?{currentScene:r="liveRoom",scene:{liveRoom:{isNewComer:i,isAIRequired:!1,aiInfo:i?{openId:s.openId||s.open_id,nickName:s.nickName,avatarUrl:s.avatarUrl,gender:s.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!0}:void 0}}}:"wonderland"===this._query.launchScene?{currentScene:r="wonderland",scene:{wonderland:{isNewComer:this._query.newcomer,aiInfo:i?{openId:s.openId||s.open_id,nickName:s.nickName,avatarUrl:s.avatarUrl,gender:s.gender,city:"",province:"",country:"",language:"",isLiveStreaming:!1}:void 0}}}:{currentScene:r="",scene:{}},this._userInfo={openId:(u=this._query.userInfo||{}).openId||u.open_id,nickName:u.nickName,avatarUrl:u.avatarUrl,gender:u.gender,city:"",province:"",country:"",language:"",isLiveStreaming:"liveRoom"===r},this._options=n,this._hasInit=!0,t.resolve(),[2,t.promise]}))}))},e.getConfig=function(){if(!this._hasInit)throw new v(L.WITHOUT_INIT,"please invoke init() before!");return this._config},e.getUserInfo=function(){if(!this._hasInit)throw new v(L.WITHOUT_INIT,"please invoke init() before!");return this._userInfo},e.startSingleMatch=function(e){return void 0===e&&(e={retryCount:3}),d(this,void 0,void 0,(function(){var n,t;return m(this,(function(o){if(n=new N,!this._hasInit)throw new v(L.WITHOUT_INIT,"please invoke init() before!");return(t=new C({appID:this._options.appId,environment:"online"===this._query.environment?"online":"test",playerRole:this._userInfo.isLiveStreaming?"streamer":"unknown",hostAppId:this._query.hostAppId,gameId:this._options.appId||this._query.gameId,playerNumber:2,launchScene:this._query.launchScene,isMultiPlayer:!1,userInfo:this._userInfo,debugInstance:this._debugInstance,debug:this._options.debug,retryCount:e.retryCount})).startMatch(),n.resolve(t),[2,n.promise]}))}))},e.joinGameRoom=function(e){return d(this,void 0,void 0,(function(){var n,t;return m(this,(function(o){if(!this._hasInit)throw new v(L.WITHOUT_INIT,"please invoke init() before!");return n=new N,(t=new y({roomNum:e.roomNum,userInfo:this._userInfo,debugInstance:this._debugInstance,gameId:this._options.appId||this._query.gameId,hostAppId:this._query.hostAppId,environment:"release"===this._query.environment?"online":"test"})).on("open",(function(){n.resolve(t)})),setTimeout((function(){n.reject({code:void 0,msg:"join game room fail"})}),3e4),[2,n.promise]}))}))},e.joinRTCForGameRoom=function(e){return d(this,void 0,void 0,(function(){var n,t;return m(this,(function(o){if(!this._hasInit)throw new v(L.WITHOUT_INIT,"please invoke init() before!");if(n=new N,t=this.getMicrophoneUI()){this.log("input open micro data",{openID:this._userInfo.openId,roomNum:e.roomNum,appID:this._options.appId,source:"live"});try{t.show({openID:this._userInfo.openId,roomNum:e.roomNum,appID:this._options.appId,source:"live"})}catch(e){this.log("open micro error",e)}}return n.resolve(),[2,n.promise]}))}))},e.getMicrophoneUI=function(){return"undefined"!=typeof cc?o.MicrophoneUI:"undefined"!=typeof Laya?i.MicrophoneUILaya.instance:null},e.getDebugUI=function(){return"undefined"!=typeof cc?o.DebugUI:"undefined"!=typeof Laya?i.DebugUI.instance:null},e.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._debugInstance&&this._debugInstance.log(e)},e.GAME_ENV=l,e.MATCH_TYPE=p,e.BUSINESS_SCENE=f,e.utils=M,e._hasInit=!1,e}();

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        