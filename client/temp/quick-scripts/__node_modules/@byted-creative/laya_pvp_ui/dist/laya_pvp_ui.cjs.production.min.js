(function() {"use strict";var __module = CC_EDITOR ? module : {exports:{}};var __filename = 'preview-scripts/__node_modules/@byted-creative/laya_pvp_ui/dist/laya_pvp_ui.cjs.production.min.js';var __require = CC_EDITOR ? function (request) {return cc.require(request, require);} : function (request) {return cc.require(request, __filename);};function __define (exports, require, module) {cc._RF.push(module, '', 'laya_pvp_ui.cjs.production.min', __filename);"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("@byted-creative/pvp_microphone"),i=require("@byted-creative/live_ui_source"),s=(t=require("regenerator-runtime"))&&"object"==typeof t&&"default"in t?t.default:t;class a{constructor(){this._avartarLayout=[[{x:0,y:0}],[{x:150,y:114}],[{x:150,y:135},{x:651,y:135}],[{x:75,y:156},{x:420,y:156},{x:771,y:156}],[{x:51,y:156},{x:297,y:156},{x:543,y:156},{x:789,y:156}],[{x:72,y:90},{x:420,y:90},{x:768,y:90},{x:243,y:375},{x:600,y:375}],[{x:72,y:90},{x:420,y:90},{x:768,y:90},{x:72,y:375},{x:420,y:375},{x:768,y:375}],[{x:51,y:90},{x:297,y:90},{x:543,y:90},{x:795,y:90},{x:177,y:375},{x:426,y:375},{x:675,y:375}],[{x:51,y:90},{x:297,y:90},{x:543,y:90},{x:795,y:90},{x:51,y:375},{x:297,y:375},{x:543,y:375},{x:795,y:375}],[{x:75,y:90},{x:420,y:90},{x:771,y:90},{x:75,y:375},{x:420,y:375},{x:771,y:375},{x:75,y:660},{x:420,y:660},{x:771,y:660}]]}static get instance(){return null==a._instance&&(a._instance=new a,a._instance._createUI()),a._instance}_setScale(t,e){t.scaleX=e,t.scaleY=e}_setLocation(t,e,i){t.x=this._leftMargin+e*this._scale,t.y=this._topMargin+i*this._scale}_createUI(){this._scale=Laya.stage.width/1125<Laya.stage.height/2001?Laya.stage.width/1125:Laya.stage.height/2001,this._leftMargin=(Laya.stage.width-1125*this._scale)/2,this._topMargin=(Laya.stage.height-2001*this._scale)/2,this._dialog=new Laya.Dialog,this._bgImg=new Laya.Image(i.BACKGROUNDIMG),this._headbgImg=new Laya.Image(i.AVATARBGMIN),this._pointImgs=new Array(5),this._leaveBtn=new Laya.Image(i.LEAVEBTN),this._wait=new Laya.Image(i.MATCHIMG),this._success=new Laya.Image(i.MATCHSUCCESS),this._dialog.width=this._bgImg.width=Laya.stage.width,this._dialog.height=this._bgImg.height=Laya.stage.height,this._dialog.on(Laya.Event.CLICK,this,t=>{t&&t.stopPropagation&&t.stopPropagation()}),this._dialog.popupEffect=new Laya.Handler,this._dialog.closeEffect=new Laya.Handler,this._setScale(this._headbgImg,this._scale),this._setScale(this._leaveBtn,this._scale),this._setScale(this._wait,this._scale),this._setScale(this._success,this._scale),this._wait.anchorX=this._success.anchorX=.5,this._wait.anchorY=this._success.anchorY=.5,this._setLocation(this._headbgImg,60,726),this._setLocation(this._leaveBtn,867,1749),this._setLocation(this._wait,562.5,513),this._setLocation(this._success,562.5,513),this._closeEvent=()=>{this.close()},this._leaveBtn.on(Laya.Event.CLICK,this,this._closeEvent),this._masksp=new Laya.Image(i.WHITECIRCLE);for(let t=0;t<5;t++)this._pointImgs[t]=new Laya.Image(i.LITTLECIRCLE),this._pointImgs[t].anchorX=this._pointImgs[t].anchorY=.5,this._wait.addChild(this._pointImgs[t]),this._pointImgs[t].x=465+45*t,this._pointImgs[t].y=615;this._dialog.addChild(this._bgImg),this._dialog.addChild(this._headbgImg),this._dialog.addChild(this._wait),this._dialog.addChild(this._success);const t=new Laya.Sprite;Laya.stage.addChild(t),t.addChild(Laya.Dialog.manager)}_updateWaitUI(){const t=this._waittime%5;for(let e=0;e<5;e++)this._pointImgs[e].skin=e===t?i.BIGCIRCLE:i.LITTLECIRCLE}_updateTime(){this._waittime++,this._updateWaitUI()}_updateHeads(t,e,s=!1){this._headbgImg.removeChildren(),this._headbgImg.skin=t<5?i.AVATARBGMIN:t<9?i.AVATARBGMID:i.AVATARBGMAX;const h=this._avartarLayout[t];if(h)for(let o=0;o<t;o++){const n=new Laya.Image;n.x=h[o].x,n.y=h[o].y,this._headbgImg.addChild(n);const l=new Laya.Image;if(l.width=t<3?180:144,n.width=l.width+2*(t<3?12:9),l.height=t<3?180:144,this._masksp.width=t<3?180:144,this._masksp.height=t<3?180:144,l.x=t<3?12:9,l.y=t<3?12:9,o<e.length&&s||0===o){const t=new window.Image;t.crossOrigin="anonymous",t.src=e[o].avatarUrl,t.onload=()=>{const e=t.width/l.width,i=new Laya.Texture2D(t.width/e,t.height/e,Laya.Texture2D.FORMAT_R8G8B8A8);l.graphics.drawImage(new Laya.Texture(i),0,0),i.loadImageSource(t),l.mask=a.instance._masksp}}else l.skin=i.DEFAULTAVATAR;if(n.addChild(l),o<e.length&&e[o].isAnchor){const e=new Laya.Image(i.REDCIRCLE),s=new Laya.Image(i.ZHIBOZHONG);e.width=e.height=t<3?204:162,s.x=t<3?45:36,s.y=t<3?168:132,s.width=t<3?114:90.54,s.height=t<3?45:35.73,n.addChild(e),n.addChild(s)}const r=new Laya.Label;if(o<e.length?(r.text=e[o].nickName,r.alpha=1):(r.text="等待玩家",r.alpha=.5),r.fontSize=42,r.color="#ffffff",r.autoSize=!0,r.width>1.2*n.width){const t=r.text.toString();let e=1;for(;r.text=t.slice(0,e),r.text=r.text+"...",e++,r.autoSize=!0,!(e===t.length||r.width>1.2*l.width););}n.addChild(r),r.y=t<3?225:186,r.x=(n.width-r.width)/2}}show(t,e,i=!1){o.instance.close(),this._dialog.visible=!0,Laya.timer.clear(this,this._updateTime),this._headbgImg.removeChildren(),this._setScale(this._wait,this._scale),this._success.visible=!1,this._wait.visible=!0,this._waittime=0,this._myOpenId=e.openId,this._updateHeads(t,[e],!0),this._dialog.show(),this._updateWaitUI(),i&&(this._setScale(Laya.Stat,this._scale),Laya.Stat.show(0,0),h.instance.show()),Laya.timer.loop(300,this,this._updateTime)}matchSuccess(t){this._closePromise=new Promise(t=>this._closeResolve=t);const e=[];for(let i=0;i<t.length;i++)t[i].extraInfo.openId===this._myOpenId&&e.push(t[i].extraInfo);for(let i=0;i<t.length;i++)t[i].extraInfo.openId!==this._myOpenId&&e.push(t[i].extraInfo);this._dialog.visible=!0,this._dialog.show();const i=e.length;Laya.timer.clear(this,this._updateTime),this._headbgImg.removeChildren(),this._updateHeads(i,e,!1),Laya.Tween.to(this._wait,{scaleX:.01,scaleY:.01},500,Laya.Ease.backOut,Laya.Handler.create(this,()=>{this._success.visible=!1,this._success.scaleX=.01,this._success.scaleY=.01,this._success.visible=!0,Laya.Tween.to(this._success,{scaleX:this._scale,scaleY:this._scale},500,Laya.Ease.backOut,Laya.Handler.create(this,()=>{this._headbgImg.removeChildren(),this._updateHeads(i,e,!0),Laya.timer.once(3e3,this,this.close)}))}))}whenClosed(){return this._closePromise}setCloseEvent(t){this._closeEvent=t}close(){this._headbgImg.removeChildren(),Laya.timer.clear(this,this._updateTime),this._dialog.close(),this._dialog.visible=!1,this._closeResolve&&(this._closeResolve(),this._closeResolve=null)}}class h{constructor(){this._logString="",this._seen=[]}static get instance(){return null==h._instance&&(h._instance=new h,h._instance._createUI()),h._instance}_createUI(){this._debugbtn=new Laya.Button(void 0,"vConsole"),this._debugclr=new Laya.Button(void 0,"clear"),this._debugbtn.graphics.drawRect(0,0,200,60,"#00dd00"),this._debugclr.graphics.drawRect(0,0,200,60,"#00dd00"),this._debugbtn.labelColors="#ffffff",this._debugclr.labelColors="#ffffff",this._debugpnl=new Laya.Panel,this._debuglbl=new Laya.Text,this._debugbtn.size(200,60),this._debugclr.size(200,60),this._debugpnl.size(Laya.stage.width,Laya.stage.height),this._debuglbl.size(Laya.stage.width,Laya.stage.height-60),Laya.stage.addChild(this._debugbtn),Laya.stage.addChild(this._debugpnl),this._debugpnl.addChild(this._debuglbl),this._debugpnl.addChild(this._debugclr),this._debugpnl.x=0,this._debugpnl.y=0,this._debuglbl.x=0,this._debuglbl.y=0,this._debugclr.x=200,this._debugbtn.y=this._debugclr.y=Laya.stage.height-60,this._debugbtn.zOrder=999999999,this._debugpnl.zOrder=999999998,this._debuglbl.bgColor="#ffffff",this._debuglbl.overflow=Laya.Text.SCROLL,this._debuglbl.wordWrap=!0,this._debuglbl.fontSize=32,this._debugbtn.labelSize=32,this._debugclr.labelSize=32,this._debuglbl.on(Laya.Event.MOUSE_DOWN,this,this._startScrollText),this._debugbtn.on(Laya.Event.CLICK,this,this._onClickDebug),this._debugclr.on(Laya.Event.CLICK,this,this._onClickClear),this._debugbtn.visible=!1,this._debugpnl.visible=!1}show(){this._debugbtn.visible=!0}log(t){this._logString&&(this._logString+="\n");for(let e=0;e<t.length;e++)if(Array.isArray(t[e])){const i=t[e];for(let t=0;t<i.length;t++)this._logString+="string"==typeof i[t]?i[t]:JSON.stringify(i[t],this.replace),this._seen=[],this._logString+=" "}else this._logString+="string"==typeof t[e]?t[e]:JSON.stringify(t[e],this.replace),this._seen=[],this._logString+=" ";this._debuglbl&&(this._debuglbl.text=this._logString)}replace(...t){const e=t[1];if(null!=e&&"object"==typeof e){if(h.instance._seen.indexOf(e)>=0)return;h.instance._seen.push(e)}return e}_onClickDebug(){this._debugpnl.visible=!this._debugpnl.visible,this._debugpnl.visible?Laya.Stat.hide():Laya.Stat.show()}_onClickClear(){this._logString="",this._debuglbl.text=""}_startScrollText(){this._prevX=this._debuglbl.mouseX,this._prevY=this._debuglbl.mouseY,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this._scrollText),Laya.stage.on(Laya.Event.MOUSE_UP,this,this._finishScrollText)}_finishScrollText(){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this._scrollText),Laya.stage.off(Laya.Event.MOUSE_UP,this,this._finishScrollText)}_scrollText(){const t=this._debuglbl.mouseX,e=this._debuglbl.mouseY;this._debuglbl.scrollX+=this._prevX-t,this._debuglbl.scrollY+=this._prevY-e,this._prevX=t,this._prevY=e}}class o{constructor(){this._isMyOpen=!1,this._isOtherOpen=!1}static get instance(){return null==o._instance&&(o._instance=new o,o._instance._createUI()),o._instance}_updateUI(){this._mySprite.skin=this._isMyOpen?i.MICMYOPEN:i.MICMYCLOSE,this._otherSprite.skin=this._isOtherOpen?i.MICOTHEROPEN:i.MICOTHERCLOSE}_createUI(){const t=Laya.stage.width/1125<Laya.stage.height/2001?Laya.stage.width/1125:Laya.stage.height/2001;this._dialog=new Laya.Scene,this._mySprite=new Laya.Image,this._otherSprite=new Laya.Image,this._dialog.width=249*t,this._dialog.height=96*t,this._dialog.y=51*t,this._dialog.x=Laya.stage.width-this._dialog.width,this._mySprite.width=this._mySprite.height=this._otherSprite.width=this._otherSprite.height=96*t,this._otherSprite.right=33*t,this._updateUI(),this._mySprite.on(Laya.Event.CLICK,this,this.clickMyChat),this._otherSprite.on(Laya.Event.CLICK,this,this.clickOtherChat),this._dialog.addChild(this._mySprite),this._dialog.addChild(this._otherSprite),this._dialog.visible=!1,Laya.stage.addChild(this._dialog),this._dialog.zOrder=999999999}show(t){return i=this,void 0,a=void 0,h=s.mark((function i(){return s.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s){i.next=2;break}return i.abrupt("return",!1);case 2:return i.prev=2,i.next=5,e.PVPMicrophone.init({openID:t.openID,roomNum:t.roomNum,appID:t.appID,source:t.source});case 5:i.next=12;break;case 7:return i.prev=7,i.t0=i.catch(2),console.error("init error",i.t0),this.close(),i.abrupt("return");case 12:return console.log("init success"),console.log(e.PVPMicrophone.getDebugInfo()),i.prev=14,i.next=17,e.PVPMicrophone.startChat();case 17:i.next=24;break;case 19:return i.prev=19,i.t1=i.catch(14),console.error("start chat error",i.t1),this.close(),i.abrupt("return",!1);case 24:console.log("startChat success"),this._isMyOpen=e.PVPMicrophone.getAudioStatus().local,this._isOtherOpen=e.PVPMicrophone.getAudioStatus().remote,this._updateUI(),this._dialog.visible=!0,this._dialog.active=!0;case 30:case"end":return i.stop()}}),i,this,[[2,7],[14,19]])})),new(a||(a=Promise))((function(t,e){function s(t){try{n(h.next(t))}catch(t){e(t)}}function o(t){try{n(h.throw(t))}catch(t){e(t)}}function n(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(t){t(i)}))).then(s,o)}n((h=h.apply(i,[])).next())}));var i,a,h}close(){this._dialog&&(console.log("close laya microphone ui"),e.PVPMicrophone.endChat(),this._dialog.visible=!1,this._dialog.active=!1)}clickMyChat(){this._isMyOpen?e.PVPMicrophone.disableLocalAudio().then(()=>{this._isMyOpen=!1,this._updateUI(),console.log("disableLocalAudio success")}).catch(t=>{console.error("disableLocalAudio error",t)}):e.PVPMicrophone.enableLocalAudio().then(()=>{this._isMyOpen=!0,this._updateUI(),console.log("enableLocalAudio success")}).catch(t=>{console.error("enableLocalAudio error",t)})}clickOtherChat(){this._isOtherOpen?e.PVPMicrophone.muteAllRemoteAudioStream().then(()=>{this._isOtherOpen=!1,this._updateUI(),console.log("muteAllRemoteAudioStream success")}).catch(t=>{console.error("muteAllRemoteAudioStream error",t)}):e.PVPMicrophone.unmuteAllRemoteAudioStream().then(()=>{this._isOtherOpen=!0,this._updateUI(),console.log("unmuteAllRemoteAudioStream success")}).catch(t=>{console.error("unmuteAllRemoteAudioStream error",t)})}}exports.DebugUI=h,exports.MatchUILaya=a,exports.MicrophoneUILaya=o;

cc._RF.pop();
        }
        if (CC_EDITOR) {
            __define(__module.exports, __require, __module);
        }
        else {
            cc.registerModuleFunc(__filename, function () {
                __define(__module.exports, __require, __module);
            });
        }
        })();
        
        